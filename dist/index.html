<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">

  <!-- SEO Meta Tags -->
  <title>MindLoop CostOS - Restaurant Intelligence Platform</title>
  <meta name="description"
    content="Plataforma de inteligencia para restaurantes. Gestiona costes, recetas, inventario y an√°lisis financiero de tu negocio gastron√≥mico.">
  <meta name="keywords" content="restaurante, gesti√≥n, costes, recetas, inventario, food cost, hosteler√≠a, MindLoop">
  <meta name="author" content="MindLoop IA">
  <meta name="robots" content="index, follow">

  <!-- Open Graph / Social Media -->
  <meta property="og:type" content="website">
  <meta property="og:title" content="MindLoop CostOS - Restaurant Intelligence">
  <meta property="og:description"
    content="Plataforma de inteligencia para restaurantes. Gesti√≥n de costes, recetas e inventario.">
  <meta property="og:url" content="https://klaker79.github.io/lacaletacost/">

  <!-- PWA / Mobile -->
  <meta name="theme-color" content="#667eea">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="MindLoop CostOS">

  <!-- Favicon -->
  <link rel="icon" href="https://em-content.zobj.net/source/apple/391/pot-of-food_1f372.png" type="image/png">
  <link rel="apple-touch-icon" href="https://em-content.zobj.net/source/apple/391/pot-of-food_1f372.png">

  <!-- Preconnect para performance -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700;800&display=swap"
    rel="stylesheet">

  <!-- Scripts externos: Migrados a npm (ver src/vendors.js) -->
  <!-- Chart.js, XLSX, jsPDF ahora se cargan desde node_modules -->
  <!-- Esto mejora seguridad y control de versiones -->


  <!-- M√≥dulos ES6 -->
  <script type="module" crossorigin src="/assets/main-DuRhj748.js"></script>
  <link rel="stylesheet" crossorigin href="/assets/main-lvaqoULS.css">
</head>

<body>
  <!-- Pantalla de Login -->
  <div id="login-screen" class="login-screen">
    <div class="login-container">
      <div class="login-header">
        <h1>üçΩÔ∏è MindLoop CostOS</h1>
        <p>Restaurant Intelligence Platform</p>
      </div>
      <form id="login-form" class="login-form">
        <div class="form-group">
          <label for="login-email">Email</label>
          <input type="email" id="login-email" placeholder="tu@email.com" required>
        </div>
        <div class="form-group">
          <label for="login-password">Contrase√±a</label>
          <input type="password" id="login-password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
        </div>
        <button type="submit" class="login-btn">Iniciar Sesi√≥n</button>
        <p id="login-error" class="login-error"></p>
      </form>
      <div class="login-footer">
        <p>¬øNo tienes cuenta? <a href="#" onclick="mostrarRegistro()">Registrar restaurante</a></p>
      </div>
    </div>
  </div>

  <div class="container" id="app-container" style="display: none;">
    <div class="header" style="justify-content: space-between; padding: 20px 30px;">
      <div style="display: flex; align-items: center; flex: 1; gap: 20px;">
        <div>
          <h1
            style="margin: 0; font-size: 2rem; font-weight: 800; letter-spacing: -0.5px; background: linear-gradient(135deg, #ff8c42 0%, #ffb347 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">
            MindLoop CostOS</h1>
          <p
            style="margin: 4px 0 0 0; font-size: 0.95rem; color: rgba(255,255,255,0.85); font-weight: 500; letter-spacing: 0.5px;">
            Restaurant Intelligence Platform</p>
        </div>
      </div>
      <div style="display: flex; align-items: center; gap: 20px;">
        <span id="user-restaurant" style="color: rgba(255,255,255,0.9); font-size: 14px; font-weight: 500;"></span>
        <button onclick="logout()"
          style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); color: white; border: none; padding: 10px 20px; border-radius: 10px; cursor: pointer; font-size: 14px; font-weight: 600; box-shadow: 0 4px 15px rgba(239,68,68,0.4); transition: all 0.3s ease;"
          onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(239,68,68,0.5)';"
          onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(239,68,68,0.4)';">Cerrar
          Sesi√≥n</button>
      </div>
    </div>

    <!-- üóìÔ∏è Banner de Fecha Actual -->
    <div id="fecha-actual-banner" style="
      margin: 0 32px 16px 32px;
      padding: 12px 20px;
      background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
      border-radius: 12px;
      border-left: 4px solid #0ea5e9;
      display: flex;
      justify-content: space-between;
      align-items: center;
    ">
      <div style="display: flex; align-items: center; gap: 12px;">
        <span style="font-size: 24px;">üìÖ</span>
        <div>
          <div id="fecha-hoy-texto" style="font-size: 16px; font-weight: 600; color: #0c4a6e;">
            Cargando fecha...
          </div>
          <div id="periodo-info" style="font-size: 12px; color: #0369a1; margin-top: 2px;">
            Semana X ¬∑ Mes de XXXX
          </div>
        </div>
      </div>
      <div style="display: flex; gap: 8px;">
        <button onclick="window.cambiarPeriodoVista('hoy')" class="periodo-btn" data-periodo="hoy" style="
          padding: 6px 12px;
          border-radius: 6px;
          border: 1px solid #0ea5e9;
          background: white;
          color: #0369a1;
          font-size: 12px;
          font-weight: 500;
          cursor: pointer;
          transition: all 0.2s;
        ">Hoy</button>
        <button onclick="window.cambiarPeriodoVista('semana')" class="periodo-btn active" data-periodo="semana" style="
          padding: 6px 12px;
          border-radius: 6px;
          border: 1px solid #0ea5e9;
          background: #0ea5e9;
          color: white;
          font-size: 12px;
          font-weight: 500;
          cursor: pointer;
          transition: all 0.2s;
        ">Semana</button>
        <button onclick="window.cambiarPeriodoVista('mes')" class="periodo-btn" data-periodo="mes" style="
          padding: 6px 12px;
          border-radius: 6px;
          border: 1px solid #0ea5e9;
          background: white;
          color: #0369a1;
          font-size: 12px;
          font-weight: 500;
          cursor: pointer;
          transition: all 0.2s;
        ">Mes</button>
      </div>
    </div>

    <!-- KPI Dashboard -->
    <div class="kpi-dashboard">
      <div class="kpi-card">
        <div class="kpi-icon">üí∞</div>
        <div class="kpi-label">Ingresos totales</div>
        <div class="kpi-value" id="kpi-ingresos">0‚Ç¨</div>
        <div class="kpi-trend positive">
          <span>‚Üó</span> <span id="kpi-ingresos-trend">+0%</span> este mes
        </div>
      </div>

      <div class="kpi-card">
        <div class="kpi-icon">üìã</div>
        <div class="kpi-label">Pedidos activos</div>
        <div class="kpi-value" id="kpi-pedidos">0</div>
        <div class="kpi-trend positive">
          <span>‚Üó</span> <span id="kpi-pedidos-trend">+0%</span> vs anterior
        </div>
      </div>

      <div class="kpi-card">
        <div class="kpi-icon">‚ö†Ô∏è</div>
        <div class="kpi-label">Stock bajo</div>
        <div class="kpi-value" id="kpi-stock">0</div>
        <div class="kpi-trend warning">
          <span>‚ö°</span> <span id="kpi-stock-msg">Requieren atenci√≥n</span>
        </div>
      </div>

      <div class="kpi-card">
        <div class="kpi-icon">üìä</div>
        <div class="kpi-label">Margen promedio</div>
        <div class="kpi-value" id="kpi-margen">0%</div>
        <div class="kpi-trend positive">
          <span>‚Üó</span> <span id="kpi-margen-trend">+0%</span> objetivo
        </div>
      </div>
    </div>
    <!-- Dashboard Expandido -->
    <div id="dashboard-expandido" class="dashboard-expandido"
      style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin: 0 32px 24px 32px;">

      <!-- Alertas de Stock -->
      <div class="dashboard-card"
        style="background: white; border-radius: 16px; padding: 20px; box-shadow: 0 2px 12px rgba(0,0,0,0.08);">
        <h3 style="margin: 0 0 16px 0; font-size: 16px; color: #1E293B; display: flex; align-items: center; gap: 8px;">
          üö® Alertas de Stock
        </h3>
        <div id="alertas-stock-lista" style="max-height: 150px; overflow-y: auto; font-size: 14px;">
          <p style="color: #64748B; margin: 0;">Cargando...</p>
        </div>
      </div>

      <!-- Resumen del D√≠a -->
      <div class="dashboard-card"
        style="background: white; border-radius: 16px; padding: 20px; box-shadow: 0 2px 12px rgba(0,0,0,0.08);">
        <h3 style="margin: 0 0 16px 0; font-size: 16px; color: #1E293B; display: flex; align-items: center; gap: 8px;">
          üìä Resumen de Hoy
        </h3>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
          <div style="text-align: center; padding: 12px; background: #F0FDF4; border-radius: 8px;">
            <div style="font-size: 24px; font-weight: 700; color: #10B981;" id="ventas-hoy">0</div>
            <div style="font-size: 12px; color: #64748B;">Ventas</div>
          </div>
          <div style="text-align: center; padding: 12px; background: #EFF6FF; border-radius: 8px;">
            <div style="font-size: 24px; font-weight: 700; color: #3B82F6;" id="ingresos-hoy">0‚Ç¨</div>
            <div style="font-size: 12px; color: #64748B;">Ingresos</div>
          </div>
        </div>
        <div style="margin-top: 12px; padding: 12px; background: #FFF7ED; border-radius: 8px; text-align: center;">
          <div style="font-size: 12px; color: #64748B;">Plato estrella hoy</div>
          <div style="font-size: 14px; font-weight: 600; color: #F59E0B;" id="plato-estrella-hoy">-</div>
        </div>
      </div>

      <!-- Accesos R√°pidos -->
      <div class="dashboard-card"
        style="background: white; border-radius: 16px; padding: 20px; box-shadow: 0 2px 12px rgba(0,0,0,0.08);">
        <h3 style="margin: 0 0 16px 0; font-size: 16px; color: #1E293B; display: flex; align-items: center; gap: 8px;">
          ‚ö° Acciones R√°pidas
        </h3>
        <div style="display: flex; flex-direction: column; gap: 10px;">
          <button onclick="window.cambiarTab('ventas'); document.getElementById('venta-receta').focus();"
            style="padding: 12px; background: linear-gradient(135deg, #10B981, #059669); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 14px;">
            üí∞ Nueva Venta
          </button>
          <button
            onclick="window.cambiarTab('pedidos'); window.mostrarFormularioPedido && window.mostrarFormularioPedido();"
            style="padding: 12px; background: linear-gradient(135deg, #3B82F6, #2563EB); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 14px;">
            üì¶ Nuevo Pedido
          </button>
          <button onclick="window.cambiarTab('inventario');"
            style="padding: 12px; background: linear-gradient(135deg, #F59E0B, #D97706); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 14px;">
            üîç Ver Inventario
          </button>
        </div>
      </div>


    </div>
    <div class="tabs">
      <button id="tab-btn-ingredientes" class="tab active" onclick="window.cambiarTab('ingredientes')">üì¶
        Ingredientes</button>
      <button id="tab-btn-recetas" class="tab" onclick="window.cambiarTab('recetas')">üë®‚Äçüç≥ Recetas</button>
      <button id="tab-btn-proveedores" class="tab" onclick="window.cambiarTab('proveedores')">üöö Proveedores</button>
      <button id="tab-btn-pedidos" class="tab" onclick="window.cambiarTab('pedidos')">üìã Pedidos</button>
      <button id="tab-btn-analisis" class="tab" onclick="window.cambiarTab('analisis')">üìä An√°lisis</button>
      <button id="tab-btn-inventario" class="tab" onclick="window.cambiarTab('inventario')">üì¶ Inventario<span
          id="badge-inventario" class="tab-badge" style="display:none;">0</span></button>
      <button id="tab-btn-ventas" class="tab" onclick="window.cambiarTab('ventas')">üí∞ Ventas</button>

      <button id="tab-btn-diario" class="tab" onclick="window.cambiarTab('diario')">üìà Diario</button>
      <button id="tab-btn-configuracion" class="tab" onclick="window.cambiarTab('configuracion')">‚öôÔ∏è
        Configuraci√≥n</button>
    </div>

    <div class="main-card">



      <!-- TAB: INGREDIENTES (c√≥digo anterior simplificado por brevedad) -->
      <div id="tab-ingredientes" class="tab-content active">
        <div class="top-bar">
          <div>
            <h2>Ingredientes</h2>
            <p>Gestiona todos los ingredientes de tu restaurante</p>
          </div>
          <div style="display: flex; gap: 10px;">
            <button class="btn btn-primary" onclick="window.mostrarFormularioIngrediente()">‚ûï A√±adir
              Ingrediente</button>
            <button class="btn btn-secondary" onclick="window.mostrarModalImportarIngredientes()">üì§ Importar
              Excel</button>
            <button class="btn btn-secondary" onclick="exportarIngredientes()">üì• Exportar Excel</button>
          </div>
        </div>
        <div class="search-box">
          <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
            <circle cx="11" cy="11" r="8" />
            <path d="m21 21-4.35-4.35" />
          </svg>
          <input type="search" id="busqueda-ingredientes" name="busqueda_ing_nocache" placeholder="Buscar..."
            autocomplete="off" oninput="window.renderizarIngredientes()">
        </div>
        <div id="formulario-ingrediente" class="form-card" style="display: none;">
          <h3>
            <span id="form-title-ingrediente">Nuevo Ingrediente</span>
            <button class="close-btn" onclick="window.cerrarFormularioIngrediente()">√ó</button>
          </h3>
          <form onsubmit="window.guardarIngrediente(event)">
            <div class="form-grid">
              <div class="form-group">
                <label>Nombre *</label>
                <input type="text" id="ing-nombre" required>
              </div>
              <div class="form-group">
                <label>Proveedor</label>
                <select id="ing-proveedor-select">
                  <option value="">Sin proveedor</option>
                </select>
              </div>
              <div class="form-group">
                <label>Precio (‚Ç¨)</label>
                <input type="number" id="ing-precio" step="0.01" min="0">
              </div>
              <div class="form-group">
                <label>Unidad</label>
                <select id="ing-unidad">
                  <option value="kg">kg</option>
                  <option value="g">g</option>
                  <option value="l">L</option>
                  <option value="ml">ml</option>
                  <option value="unidad">Unidades</option>
                  <option value="docena">Docena</option>
                </select>
              </div>
              <div class="form-group">
                <label>Familia</label>
                <select id="ing-familia">
                  <option value="alimento">Alimento</option>
                  <option value="bebida">Bebida</option>
                </select>
              </div>
              <div class="form-group">
                <label>Stock actual</label>
                <input type="number" id="ing-stockActual" step="0.01" min="0">
              </div>
              <div class="form-group">
                <label>Stock m√≠nimo</label>
                <input type="number" id="ing-stockMinimo" step="0.01" min="0">
              </div>
            </div>
            <div class="form-actions">
              <button type="button" class="btn btn-secondary"
                onclick="window.cerrarFormularioIngrediente()">Cancelar</button>
              <button type="submit" class="btn btn-primary"><span id="btn-text-ingrediente">A√±adir</span></button>
            </div>
          </form>
        </div>
        <div id="tabla-ingredientes"></div>
        <div id="resumen-ingredientes" class="summary" style="display: none;"></div>
      </div>

      <!-- TAB: RECETAS (simplificado) -->
      <div id="tab-recetas" class="tab-content">
        <div class="top-bar">
          <div>
            <h2>Recetas</h2>
            <p>Crea recetas y calcula costes</p>
          </div>
          <div style="display: flex; gap: 10px;">
            <button class="btn btn-primary" onclick="window.mostrarFormularioReceta()">‚ûï Nueva Receta</button>
            <button class="btn btn-secondary" onclick="window.mostrarModalImportarRecetas()">üì§ Importar Excel</button>
            <button class="btn btn-secondary" onclick="exportarRecetas()">üì• Exportar Excel</button>
          </div>
        </div>
        <div class="search-box">
          <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
            <circle cx="11" cy="11" r="8" />
            <path d="m21 21-4.35-4.35" />
          </svg>
          <input type="search" id="busqueda-recetas" name="busqueda_rec_nocache" placeholder="Buscar..."
            autocomplete="off" oninput="window.renderizarRecetas()">
        </div>
        <div id="formulario-receta" class="form-card" style="display: none;">
          <h3>
            <span id="form-title-receta">Nueva Receta</span>
            <button class="close-btn" onclick="window.cerrarFormularioReceta()">√ó</button>
          </h3>
          <form onsubmit="window.guardarReceta(event)">
            <div class="form-grid">
              <div class="form-group">
                <label>Nombre *</label>
                <input type="text" id="rec-nombre" required>
              </div>
              <div class="form-group">
                <label>C√≥digo TPV</label>
                <input type="text" id="rec-codigo" placeholder="Ej: 101">
              </div>
              <div class="form-group">
                <label>Categor√≠a</label>
                <select id="rec-categoria">
                  <option value="entrante">Entrante</option>
                  <option value="principal">Principal</option>
                  <option value="postre">Postre</option>
                  <option value="bebida">Bebida</option>
                </select>
              </div>
              <div class="form-group">
                <label>Precio venta (‚Ç¨)</label>
                <input type="number" id="rec-precio_venta" step="0.01" min="0" oninput="window.calcularCosteReceta()">
              </div>
              <div class="form-group">
                <label>Porciones</label>
                <input type="number" id="rec-porciones" min="1" value="1">
              </div>
            </div>
            <div class="ingredientes-receta">
              <h4>Ingredientes</h4>
              <div id="lista-ingredientes-receta"></div>
              <button type="button" class="btn btn-secondary btn-small" onclick="window.agregarIngredienteReceta()">+
                A√±adir</button>
            </div>
            <div id="coste-calculado-form" class="coste-calculado" style="display: none;">
              <!-- Panel de An√°lisis de Costes - Dise√±o Premium -->
              <div
                style="background: linear-gradient(135deg, #059669 0%, #047857 100%); border-radius: 16px; padding: 20px; color: white; margin-bottom: 10px;">
                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 20px;">
                  <span style="font-size: 28px;">üìä</span>
                  <div>
                    <h4 style="margin: 0; font-size: 18px; font-weight: 700;">An√°lisis Financiero</h4>
                    <p style="margin: 0; font-size: 13px; opacity: 0.9;">Rentabilidad en tiempo real</p>
                  </div>
                </div>

                <!-- Coste Total -->
                <div
                  style="background: rgba(255,255,255,0.15); border-radius: 12px; padding: 16px; margin-bottom: 12px; backdrop-filter: blur(10px);">
                  <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                      <div style="display: flex; align-items: center; gap: 8px;">
                        <span style="font-size: 20px;">üí∞</span>
                        <span style="font-size: 15px; font-weight: 600;">Coste de Producci√≥n</span>
                      </div>
                      <p style="margin: 4px 0 0 28px; font-size: 12px; opacity: 0.85;">
                        Suma de todos los ingredientes
                      </p>
                    </div>
                    <div style="text-align: right;">
                      <strong id="coste-receta-valor" style="font-size: 28px; font-weight: 800;">0.00‚Ç¨</strong>
                    </div>
                  </div>
                </div>

                <!-- Food Cost % -->
                <div
                  style="background: rgba(255,255,255,0.15); border-radius: 12px; padding: 16px; margin-bottom: 12px; backdrop-filter: blur(10px);">
                  <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                      <div style="display: flex; align-items: center; gap: 8px;">
                        <span style="font-size: 20px;">üéØ</span>
                        <span style="font-size: 15px; font-weight: 600;">Food Cost</span>
                      </div>
                      <p style="margin: 4px 0 0 28px; font-size: 12px; opacity: 0.85;">
                        % del precio que es coste (‚â§33% ideal)
                      </p>
                    </div>
                    <div style="text-align: right;">
                      <strong id="foodcost-receta-valor" style="font-size: 28px; font-weight: 800;">0.0%</strong>
                    </div>
                  </div>
                </div>

                <!-- Margen -->
                <div
                  style="background: rgba(255,255,255,0.15); border-radius: 12px; padding: 16px; backdrop-filter: blur(10px);">
                  <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                      <div style="display: flex; align-items: center; gap: 8px;">
                        <span style="font-size: 20px;">üìà</span>
                        <span style="font-size: 15px; font-weight: 600;">Margen de Beneficio</span>
                      </div>
                      <p style="margin: 4px 0 0 28px; font-size: 12px; opacity: 0.85;">
                        Beneficio por cada venta
                      </p>
                    </div>
                    <div style="text-align: right;">
                      <strong id="margen-receta-valor" style="font-size: 28px; font-weight: 800;">0.0%</strong>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="form-actions">
              <button type="button" class="btn btn-secondary"
                onclick="window.cerrarFormularioReceta()">Cancelar</button>
              <button type="submit" class="btn btn-primary"><span id="btn-text-receta">Guardar</span></button>
            </div>
          </form>
        </div>
        <div id="tabla-recetas"></div>
        <div id="resumen-recetas" class="summary" style="display: none;"></div>
      </div>

      <!-- TAB: PROVEEDORES (simplificado) -->
      <div id="tab-proveedores" class="tab-content">
        <div class="top-bar">
          <div>
            <h2>Proveedores</h2>
            <p>Gestiona tus proveedores</p>
          </div>
          <button class="btn btn-primary" onclick="window.mostrarFormularioProveedor()">+ A√±adir Proveedor</button>
        </div>
        <div class="search-box">
          <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
            <circle cx="11" cy="11" r="8" />
            <path d="m21 21-4.35-4.35" />
          </svg>
          <input type="search" id="busqueda-proveedores" name="busqueda_prov_nocache" placeholder="Buscar..."
            autocomplete="off" oninput="window.renderizarProveedores()">
        </div>
        <div id="formulario-proveedor" class="form-card" style="display: none;">
          <h3>
            <span id="form-title-proveedor">Nuevo Proveedor</span>
            <button class="close-btn" onclick="window.cerrarFormularioProveedor()">√ó</button>
          </h3>
          <form onsubmit="window.guardarProveedor(event)">
            <div class="form-grid">
              <div class="form-group">
                <label>Nombre *</label>
                <input type="text" id="prov-nombre" required>
              </div>
              <div class="form-group">
                <label>Contacto</label>
                <input type="text" id="prov-contacto">
              </div>
              <div class="form-group">
                <label>Tel√©fono</label>
                <input type="tel" id="prov-telefono">
              </div>
              <div class="form-group">
                <label>Email</label>
                <input type="email" id="prov-email">
              </div>
              <div class="form-group" style="grid-column: 1 / -1;">
                <label>Direcci√≥n</label>
                <textarea id="prov-direccion"></textarea>
              </div>
              <div class="form-group" style="grid-column: 1 / -1;">
                <label>Notas</label>
                <textarea id="prov-notas"></textarea>
              </div>
            </div>
            <div class="selector-ingredientes">
              <h4>Ingredientes que suministra</h4>
              <div class="search-box" style="margin-bottom: 10px;">
                <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                  <circle cx="11" cy="11" r="8" />
                  <path d="m21 21-4.35-4.35" />
                </svg>
                <input type="text" id="buscar-ingredientes-proveedor" placeholder="Buscar..."
                  oninput="window.filtrarIngredientesProveedor()">
              </div>
              <div class="ingredientes-disponibles" id="lista-ingredientes-proveedor"></div>
            </div>
            <div class="form-actions">
              <button type="button" class="btn btn-secondary"
                onclick="window.cerrarFormularioProveedor()">Cancelar</button>
              <button type="submit" class="btn btn-primary"><span id="btn-text-proveedor">A√±adir</span></button>
            </div>
          </form>
        </div>
        <div id="tabla-proveedores"></div>
        <div id="resumen-proveedores" class="summary" style="display: none;"></div>
      </div>

      <!-- TAB: PEDIDOS -->
      <div id="tab-pedidos" class="tab-content">
        <div class="top-bar">
          <div>
            <h2>Pedidos a Proveedores</h2>
            <p>Gestiona tus pedidos y actualiza stock autom√°ticamente</p>
          </div>
          <div style="display: flex; gap: 10px;">
            <button class="btn btn-primary" onclick="window.mostrarFormularioPedido()">+ Nuevo Pedido</button>
            <button class="btn btn-secondary" onclick="window.mostrarModalImportarPedidos()">üì§ Importar
              Pedidos</button>
          </div>
        </div>

        <div class="search-box">
          <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
            <circle cx="11" cy="11" r="8" />
            <path d="m21 21-4.35-4.35" />
          </svg>
          <input type="search" id="busqueda-pedidos" name="busqueda_ped_nocache" placeholder="Buscar pedidos..."
            autocomplete="off" oninput="window.renderizarPedidos()">
        </div>

        <div id="formulario-pedido" class="form-card" style="display: none;">
          <h3>
            <span>Nuevo Pedido</span>
            <button class="close-btn" onclick="window.cerrarFormularioPedido()">√ó</button>
          </h3>
          <form onsubmit="window.guardarPedido(event)">
            <div class="form-grid">
              <div class="form-group">
                <label>Proveedor *</label>
                <select id="ped-proveedor" required onchange="window.cargarIngredientesPedido()">
                  <option value="">Seleccionar proveedor...</option>
                </select>
              </div>
              <div class="form-group">
                <label>Fecha del pedido</label>
                <input type="date" id="ped-fecha" required>
              </div>
            </div>

            <div class="ingredientes-receta" id="container-ingredientes-pedido" style="display:none;">
              <h4>Ingredientes del pedido</h4>
              <div id="lista-ingredientes-pedido"></div>
              <button type="button" class="btn btn-secondary btn-small" onclick="window.agregarIngredientePedido()">+
                A√±adir ingrediente</button>
            </div>

            <div id="total-pedido-form" style="display:none;" class="total-pedido">
              Total: <strong id="total-pedido-value">0.00 ‚Ç¨</strong>
            </div>

            <div class="form-actions" style="margin-top: 20px;">
              <button type="button" class="btn btn-secondary"
                onclick="window.cerrarFormularioPedido()">Cancelar</button>
              <button type="submit" class="btn btn-primary">Crear Pedido</button>
            </div>
          </form>
        </div>

        <div id="tabla-pedidos"></div>
        <div id="resumen-pedidos" class="summary" style="display: none;"></div>
      </div>

      <!-- TAB: AN√ÅLISIS -->
      <div id="tab-analisis" class="tab-content">
        <div class="chart-container">
          <div class="chart-header">
            <h3>üìä Ingresos vs Gastos</h3>
            <p>Evoluci√≥n financiera de los √∫ltimos 7 d√≠as</p>
          </div>
          <canvas id="revenueChart"></canvas>
        </div>

        <div id="analisis-vacio" class="empty-state">
          <div class="icon">üìä</div>
          <h3>A√∫n no hay datos</h3>
          <p>A√±ade ingredientes y recetas</p>
        </div>

        <div id="analisis-contenido" style="display: none;">
          <div class="stats-grid">
            <div class="stat-card">
              <h3>Total Recetas</h3>
              <div class="value" id="stat-total-recetas">0</div>
            </div>
            <div class="stat-card green">
              <h3>Margen Promedio</h3>
              <div class="value" id="stat-margen-promedio">0%</div>
            </div>
            <div class="stat-card blue">
              <h3>Coste Promedio</h3>
              <div class="value" id="stat-coste-promedio">0 ‚Ç¨</div>
            </div>
            <div class="stat-card orange">
              <h3>Total Ingredientes</h3>
              <div class="value" id="stat-total-ingredientes">0</div>
            </div>
          </div>
          <div class="charts-grid">
            <div class="chart-card">
              <h3>Rentabilidad por Plato</h3>
              <canvas id="chart-rentabilidad"></canvas>
            </div>
            <div class="chart-card">
              <h3>Ingredientes M√°s Caros</h3>
              <canvas id="chart-ingredientes"></canvas>
            </div>
          </div>
          <div class="chart-card">
            <h3>Ranking de Rentabilidad</h3>
            <div id="tabla-rentabilidad"></div>
          </div>

          <!-- Matriz BCG - Redise√±o Profesional -->
          <div class="chart-card" id="bcg-matrix-container" style="margin-top: 20px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
              <div>
                <h3 style="margin: 0;">üèÜ Ingenier√≠a de Men√∫</h3>
                <p style="margin: 5px 0 0; font-size: 13px; color: #64748b;">Optimiza tu carta con datos reales</p>
              </div>
              <div style="display: flex; gap: 8px;">
                <span class="bcg-legend-item" style="--color: #22c55e;">‚≠ê Estrellas</span>
                <span class="bcg-legend-item" style="--color: #3b82f6;">‚ùì Puzzles</span>
                <span class="bcg-legend-item" style="--color: #f97316;">üêé Caballos</span>
                <span class="bcg-legend-item" style="--color: #ef4444;">üê∂ Perros</span>
              </div>
            </div>

            <!-- Scatter Plot Container -->
            <div style="display: grid; grid-template-columns: 1fr 300px; gap: 20px;">
              <!-- Gr√°fico Scatter -->
              <div
                style="background: #f8fafc; border-radius: 16px; padding: 20px; position: relative; min-height: 350px;">
                <div
                  style="position: absolute; top: 10px; left: 50%; transform: translateX(-50%); font-size: 11px; color: #64748b; font-weight: 600;">
                  üìà ALTA RENTABILIDAD
                </div>
                <div
                  style="position: absolute; bottom: 10px; left: 50%; transform: translateX(-50%); font-size: 11px; color: #64748b; font-weight: 600;">
                  üìâ BAJA RENTABILIDAD
                </div>
                <div
                  style="position: absolute; left: 10px; top: 50%; transform: translateY(-50%) rotate(-90deg); font-size: 11px; color: #64748b; font-weight: 600;">
                  üîª BAJA POPULARIDAD
                </div>
                <div
                  style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%) rotate(90deg); font-size: 11px; color: #64748b; font-weight: 600;">
                  üî∫ ALTA POPULARIDAD
                </div>
                <canvas id="bcg-scatter-chart" style="width: 100%; height: 300px;"></canvas>
              </div>

              <!-- Panel de Acciones R√°pidas -->
              <div style="display: flex; flex-direction: column; gap: 12px;">
                <!-- Acci√≥n Estrellas -->
                <div class="bcg-action-card bcg-action-estrella" onclick="this.classList.toggle('expanded')">
                  <div class="bcg-action-header">
                    <span class="bcg-action-icon">‚≠ê</span>
                    <span class="bcg-action-title">Estrellas</span>
                    <span class="bcg-action-count" id="count-estrella">0</span>
                    <span class="bcg-expand-icon">‚ñº</span>
                  </div>
                  <div class="bcg-action-text">Mant√©n y destaca</div>
                  <div class="bcg-action-detail" id="detail-estrella">
                    <strong>Estrategia recomendada:</strong>
                    <ul>
                      <li>Mant√©n la calidad constante</li>
                      <li>Dest√°calos en el men√∫ principal</li>
                      <li>Considera subir precio (+5-10%)</li>
                      <li>Capacita al equipo para recomendarlos</li>
                      <li>Usa fotos en redes sociales</li>
                    </ul>
                  </div>
                </div>

                <!-- Acci√≥n Puzzles -->
                <div class="bcg-action-card bcg-action-puzzle" onclick="this.classList.toggle('expanded')">
                  <div class="bcg-action-header">
                    <span class="bcg-action-icon">‚ùì</span>
                    <span class="bcg-action-title">Puzzles</span>
                    <span class="bcg-action-count" id="count-puzzle">0</span>
                    <span class="bcg-expand-icon">‚ñº</span>
                  </div>
                  <div class="bcg-action-text">Promociona m√°s</div>
                  <div class="bcg-action-detail" id="detail-puzzle">
                    <strong>Estrategia recomendada:</strong>
                    <ul>
                      <li>Mejora la visibilidad en la carta</li>
                      <li>A√±ade foto profesional</li>
                      <li>Forma al personal para recomendarlos</li>
                      <li>Crea combos con platos populares</li>
                      <li>Si no mejoran, eval√∫a retirarlos</li>
                    </ul>
                  </div>
                </div>

                <!-- Acci√≥n Caballos -->
                <div class="bcg-action-card bcg-action-caballo" onclick="this.classList.toggle('expanded')">
                  <div class="bcg-action-header">
                    <span class="bcg-action-icon">üêé</span>
                    <span class="bcg-action-title">Caballos</span>
                    <span class="bcg-action-count" id="count-caballo">0</span>
                    <span class="bcg-expand-icon">‚ñº</span>
                  </div>
                  <div class="bcg-action-text">Sube el precio</div>
                  <div class="bcg-action-detail" id="detail-caballo">
                    <strong>‚ö†Ô∏è Atenci√≥n:</strong> Trabajan mucho pero ganan poco.
                    <ul>
                      <li>Sube el precio gradualmente (5-10%)</li>
                      <li>Renegocia con proveedores</li>
                      <li>Reduce porciones sin afectar percepci√≥n</li>
                      <li>Usa ingredientes m√°s econ√≥micos</li>
                      <li>Candidatos a retirar si no mejoran</li>
                    </ul>
                  </div>
                </div>

                <!-- Acci√≥n Perros -->
                <div class="bcg-action-card bcg-action-perro" onclick="this.classList.toggle('expanded')">
                  <div class="bcg-action-header">
                    <span class="bcg-action-icon">üê∂</span>
                    <span class="bcg-action-title">Perros</span>
                    <span class="bcg-action-count" id="count-perro">0</span>
                    <span class="bcg-expand-icon">‚ñº</span>
                  </div>
                  <div class="bcg-action-text">Retira o reforma</div>
                  <div class="bcg-action-detail" id="detail-perro">
                    <strong>üö® Acci√≥n urgente:</strong> Ocupan espacio sin aportar valor.
                    <ul>
                      <li>Ret√≠ralos del men√∫ cuanto antes</li>
                      <li>Liberan inventario y tiempo de cocina</li>
                      <li>Si tienen valor sentimental: especial del d√≠a</li>
                      <li>Reformula completamente la receta</li>
                      <li>Redirige recursos a tus Estrellas</li>
                    </ul>
                  </div>
                </div>
              </div>
            </div>

            <!-- Panel de Recomendaciones Inteligentes -->
            <div id="bcg-recommendations"
              style="margin-top: 20px; padding: 16px; background: linear-gradient(135deg, #ede9fe 0%, #ddd6fe 100%); border-radius: 12px; border: 1px solid #c4b5fd;">
              <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                <span style="font-size: 20px;">üí°</span>
                <strong style="color: #5b21b6;">Recomendaciones Inteligentes</strong>
              </div>
              <div id="bcg-recommendations-list" style="font-size: 13px; color: #4c1d95; line-height: 1.6;"></div>
            </div>

            <!-- Lista detallada colapsable -->
            <details style="margin-top: 16px;">
              <summary style="cursor: pointer; font-weight: 600; color: #64748b; padding: 10px 0;">
                üìã Ver lista detallada de platos por categor√≠a
              </summary>
              <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 15px;">
                <!-- Estrellas -->
                <div style="background: #f0fdf4; padding: 15px; border-radius: 12px; border: 2px solid #22c55e;">
                  <h4 style="color: #15803d; margin: 0 0 10px 0; font-size: 14px;">‚≠ê Estrellas</h4>
                  <div id="lista-estrella" style="display: flex; flex-wrap: wrap; gap: 8px;"></div>
                </div>
                <!-- Puzzles -->
                <div style="background: #eff6ff; padding: 15px; border-radius: 12px; border: 2px solid #3b82f6;">
                  <h4 style="color: #1d4ed8; margin: 0 0 10px 0; font-size: 14px;">‚ùì Puzzles</h4>
                  <div id="lista-puzzle" style="display: flex; flex-wrap: wrap; gap: 8px;"></div>
                </div>
                <!-- Caballos -->
                <div style="background: #fff7ed; padding: 15px; border-radius: 12px; border: 2px solid #f97316;">
                  <h4 style="color: #c2410c; margin: 0 0 10px 0; font-size: 14px;">üêé Caballos</h4>
                  <div id="lista-caballo" style="display: flex; flex-wrap: wrap; gap: 8px;"></div>
                </div>
                <!-- Perros -->
                <div style="background: #fef2f2; padding: 15px; border-radius: 12px; border: 2px solid #ef4444;">
                  <h4 style="color: #b91c1c; margin: 0 0 10px 0; font-size: 14px;">üê∂ Perros</h4>
                  <div id="lista-perro" style="display: flex; flex-wrap: wrap; gap: 8px;"></div>
                </div>
              </div>
            </details>

            <style>
              .bcg-legend-item {
                display: inline-flex;
                align-items: center;
                gap: 4px;
                font-size: 11px;
                padding: 4px 10px;
                background: white;
                border-radius: 20px;
                border: 2px solid var(--color);
                color: var(--color);
                font-weight: 600;
              }

              .bcg-action-card {
                padding: 12px 16px;
                border-radius: 12px;
                transition: all 0.2s ease;
                cursor: pointer;
              }

              .bcg-action-card:hover {
                transform: translateX(4px);
              }

              .bcg-action-header {
                display: flex;
                align-items: center;
                gap: 8px;
              }

              .bcg-action-icon {
                font-size: 18px;
              }

              .bcg-action-title {
                font-weight: 600;
                font-size: 14px;
                flex: 1;
              }

              .bcg-action-count {
                background: rgba(255, 255, 255, 0.5);
                padding: 2px 10px;
                border-radius: 12px;
                font-size: 13px;
                font-weight: 700;
              }

              .bcg-action-text {
                font-size: 12px;
                margin-top: 4px;
                opacity: 0.8;
              }

              .bcg-action-estrella {
                background: linear-gradient(135deg, #dcfce7 0%, #bbf7d0 100%);
                border: 1px solid #86efac;
                color: #15803d;
              }

              .bcg-action-puzzle {
                background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
                border: 1px solid #93c5fd;
                color: #1d4ed8;
              }

              .bcg-action-caballo {
                background: linear-gradient(135deg, #ffedd5 0%, #fed7aa 100%);
                border: 1px solid #fdba74;
                color: #c2410c;
              }

              .bcg-action-perro {
                background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
                border: 1px solid #fca5a5;
                color: #b91c1c;
              }

              /* Estilos para paneles expandibles */
              .bcg-expand-icon {
                font-size: 10px;
                opacity: 0.6;
                transition: transform 0.3s ease;
              }

              .bcg-action-card.expanded .bcg-expand-icon {
                transform: rotate(180deg);
              }

              .bcg-action-detail {
                display: none;
                margin-top: 10px;
                padding-top: 10px;
                border-top: 1px dashed currentColor;
                font-size: 12px;
                line-height: 1.5;
                opacity: 0.9;
              }

              .bcg-action-detail ul {
                margin: 8px 0 0 0;
                padding-left: 18px;
              }

              .bcg-action-detail li {
                margin-bottom: 4px;
              }

              .bcg-action-card.expanded .bcg-action-detail {
                display: block;
                animation: fadeIn 0.3s ease;
              }

              @keyframes fadeIn {
                from {
                  opacity: 0;
                  transform: translateY(-5px);
                }

                to {
                  opacity: 1;
                  transform: translateY(0);
                }
              }

              .bcg-item {
                background: white;
                padding: 8px 12px;
                border-radius: 8px;
                font-size: 12px;
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
                border: 1px solid rgba(0, 0, 0, 0.05);
                transition: transform 0.2s;
              }

              .bcg-item:hover {
                transform: scale(1.02);
              }

              @media (max-width: 768px) {
                #bcg-matrix-container>div:first-of-type {
                  flex-direction: column;
                  gap: 15px;
                }

                #bcg-matrix-container>div>div:first-child {
                  grid-template-columns: 1fr;
                }
              }
            </style>
          </div>
        </div>
      </div>

      <!-- TAB: INVENTARIO -->
      <div id="tab-inventario" class="tab-content">
        <div class="top-bar">
          <div>
            <h2>üì¶ Inventario</h2>
            <p>Control de stock de ingredientes</p>
          </div>
        </div>

        <div style="margin-bottom: 15px;">
          <button class="btn btn-secondary" onclick="window.mostrarModalInventarioMasivo()">üìä ACTUALIZAR INVENTARIO
            MASIVO</button>
          <button class="btn btn-primary" onclick="window.guardarCambiosStock()">üíæ Guardar Stock</button>
        </div>

        <div id="resumen-inventario" style="display: none; gap: 20px;"></div>


        <div class="card">
          <div style="margin-bottom: 20px;">
            <input type="text" id="busqueda-inventario" placeholder="üîç Buscar ingrediente..."
              style="width: 100%; max-width: 400px;">
          </div>

          <div id="tabla-inventario"></div>
        </div>
      </div>
      <!-- TAB: VENTAS -->
      <div id="tab-ventas" class="tab-content">
        <div class="top-bar">
          <div>
            <h2>üí∞ Ventas</h2>
            <p>Registro diario de ventas</p>
          </div>
          <button class="btn btn-secondary" onclick="window.mostrarModalImportarVentas()">üì§ Importar Ventas
            TPV</button>
        </div>

        <div class="card">
          <h3>Registrar Venta</h3>
          <form id="form-venta">
            <label>Plato:</label>
            <select id="venta-receta" required></select>

            <label>Cantidad:</label>
            <input type="number" id="venta-cantidad" min="1" value="1" required>

            <button type="submit" class="btn btn-success">Registrar Venta</button>
          </form>
        </div>
        <div class="card" style="margin-bottom: 20px;">
          <h3>üìÖ Filtrar por Fecha</h3>
          <div style="display: flex; gap: 15px; align-items: end;">
            <div class="form-group" style="flex: 1;">
              <label>Desde:</label>
              <input type="date" id="ventas-fecha-desde" class="form-control">
            </div>
            <div class="form-group" style="flex: 1;">
              <label>Hasta:</label>
              <input type="date" id="ventas-fecha-hasta" class="form-control">
            </div>
            <button class="btn btn-primary" onclick="window.renderizarVentas()">üîç Filtrar</button>
            <button class="btn btn-secondary"
              onclick="document.getElementById('ventas-fecha-desde').value=''; document.getElementById('ventas-fecha-hasta').value=''; window.renderizarVentas();">üîÑ
              Limpiar</button>
          </div>
        </div>

        <div class="card">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
            <h3 style="margin: 0;">üìä Hist√≥rico de Ventas</h3>
            <button class="btn btn-secondary" onclick="exportarVentas()">üì• Exportar Excel</button>
          </div>
          <div id="tabla-ventas"></div>
        </div>
      </div>

      <!-- TAB: DIARIO (Tracking de Costes/Ventas por D√≠a) -->
      <div id="tab-diario" class="tab-content">
        <div class="top-bar">
          <div>
            <h2>üìà Control Diario</h2>
            <p>Tracking de compras y ventas por d√≠a - Vista tipo Excel</p>
          </div>
          <div style="display: flex; gap: 10px; align-items: center;">
            <select id="diario-mes" class="form-control"
              style="padding: 10px; border-radius: 8px; border: 1px solid #ddd;">
              <option value="1">Enero</option>
              <option value="2">Febrero</option>
              <option value="3">Marzo</option>
              <option value="4">Abril</option>
              <option value="5">Mayo</option>
              <option value="6">Junio</option>
              <option value="7">Julio</option>
              <option value="8">Agosto</option>
              <option value="9">Septiembre</option>
              <option value="10">Octubre</option>
              <option value="11">Noviembre</option>
              <option value="12">Diciembre</option>
            </select>
            <select id="diario-ano" class="form-control"
              style="padding: 10px; border-radius: 8px; border: 1px solid #ddd;">
              <option value="2024">2024</option>
              <option value="2025" selected>2025</option>
              <option value="2026">2026</option>
            </select>
            <button class="btn btn-primary" onclick="window.cargarResumenMensual()">üîÑ Cargar</button>
            <button class="btn btn-secondary" onclick="window.exportarDiarioExcel()">üì• Exportar Excel</button>
          </div>
        </div>

        <!-- Selector de Vista -->
        <div style="display: flex; gap: 10px; margin-bottom: 20px;">
          <button id="btn-vista-compras" class="btn btn-primary" onclick="window.cambiarVistaDiario('compras')">üõí
            Compras (Costes)</button>
          <button id="btn-vista-ventas" class="btn btn-secondary" onclick="window.cambiarVistaDiario('ventas')">üí∞
            Ventas (Ingresos)</button>
          <button id="btn-vista-combinada" class="btn btn-secondary" onclick="window.cambiarVistaDiario('combinada')">üìä
            P&L Diario</button>
        </div>
        <!-- Tablas Diarias (FUERA del grid para que ocupen 100% ancho) -->
        <div style="margin-top: 30px;">
          <!-- Vista Compras -->
          <div id="vista-compras" class="diario-vista" style="display: block;">
            <h3 style="margin-bottom: 15px;">üõí Precio de Compra por Ingrediente / D√≠a</h3>
            <div id="tabla-compras-diarias" style="overflow-x: auto; width: 100%; max-width: 100%;">
              <p class="empty-state">Selecciona un mes y haz clic en "Cargar" para ver los datos</p>
            </div>
          </div>

          <!-- Vista Ventas -->
          <div id="vista-ventas" class="diario-vista" style="display: none;">
            <h3 style="margin-bottom: 15px;">üí∞ Ventas por Receta / D√≠a</h3>
            <div id="tabla-ventas-diarias" style="overflow-x: auto; width: 100%; max-width: 100%;">
              <p class="empty-state">Selecciona un mes y haz clic en "Cargar" para ver los datos</p>
            </div>
          </div>

          <!-- Vista Combinada (P&L) -->
          <div id="vista-combinada" class="diario-vista" style="display: none;">
            <h3 style="margin-bottom: 15px;">üìä Cuenta de Resultados Diaria</h3>
            <div id="tabla-pl-diario" style="overflow-x: auto; width: 100%; max-width: 100%;">
              <p class="empty-state">Selecciona un mes y haz clic en "Cargar" para ver los datos</p>
            </div>
          </div>
        </div>

        <!-- üí∞ BENEFICIO NETO POR D√çA (MOVIDA ABAJO) -->
        <div
          style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 16px; padding: 20px; margin-bottom: 20px; margin-top: 20px; box-shadow: 0 4px 20px rgba(102, 126, 234, 0.3);">
          <h3 style="margin: 0 0 16px 0; font-size: 16px; color: white; display: flex; align-items: center; gap: 8px;">
            üí∞ Beneficio Neto por D√≠a
          </h3>
          <div id="beneficio-neto-diario-lista"
            style="max-height: 300px; overflow-y: auto; background: white; border-radius: 12px; padding: 12px;">
            <p style="color: #64748B; margin: 0; text-align: center; padding: 20px;">Carga un mes para ver los datos</p>
          </div>
        </div>



        <!-- üí∞ GASTOS FIJOS MENSUALES -->
        <div
          style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 25px; border-radius: 16px; margin-bottom: 25px; box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);">
          <h3 style="margin: 0 0 20px 0; color: white; font-size: 20px; font-weight: 700;">üí∞ Gastos Fijos Mensuales
          </h3>
          <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px;">
            <!-- Alquiler -->
            <div>
              <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                <label style="font-weight: 600; color: rgba(255,255,255,0.9); font-size: 14px;">Alquiler Local</label>
                <span id="gf-alquiler-valor" style="font-weight: 700; color: white; font-size: 16px;">0‚Ç¨</span>
              </div>
              <input type="range" id="gf-alquiler" min="0" max="10000" step="100" value="0"
                style="width: 100%; height: 8px; border-radius: 10px; background: rgba(255,255,255,0.3); outline: none; cursor: pointer;"
                oninput="document.getElementById('gf-alquiler-valor').textContent = this.value + '‚Ç¨'; window.guardarGastoFinanzas('alquiler', 'gf-alquiler');">
            </div>

            <!-- Personal -->
            <div>
              <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                <label style="font-weight: 600; color: rgba(255,255,255,0.9); font-size: 14px;">Personal
                  (N√≥minas)</label>
                <span id="gf-personal-valor" style="font-weight: 700; color: white; font-size: 16px;">0‚Ç¨</span>
              </div>
              <input type="range" id="gf-personal" min="0" max="30000" step="100" value="0"
                style="width: 100%; height: 8px; border-radius: 10px; background: rgba(255,255,255,0.3); outline: none; cursor: pointer;"
                oninput="document.getElementById('gf-personal-valor').textContent = this.value + '‚Ç¨'; window.guardarGastoFinanzas('personal', 'gf-personal');">
            </div>

            <!-- Suministros -->
            <div>
              <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                <label style="font-weight: 600; color: rgba(255,255,255,0.9); font-size: 14px;">Suministros</label>
                <span id="gf-suministros-valor" style="font-weight: 700; color: white; font-size: 16px;">0‚Ç¨</span>
              </div>
              <input type="range" id="gf-suministros" min="0" max="5000" step="50" value="0"
                style="width: 100%; height: 8px; border-radius: 10px; background: rgba(255,255,255,0.3); outline: none; cursor: pointer;"
                oninput="document.getElementById('gf-suministros-valor').textContent = this.value + '‚Ç¨'; window.guardarGastoFinanzas('suministros', 'gf-suministros');">
            </div>

            <!-- Otros -->
            <div>
              <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                <label style="font-weight: 600; color: rgba(255,255,255,0.9); font-size: 14px;">Otros Gastos</label>
                <span id="gf-otros-valor" style="font-weight: 700; color: white; font-size: 16px;">0‚Ç¨</span>
              </div>
              <input type="range" id="gf-otros" min="0" max="5000" step="50" value="0"
                style="width: 100%; height: 8px; border-radius: 10px; background: rgba(255,255,255,0.3); outline: none; cursor: pointer;"
                oninput="document.getElementById('gf-otros-valor').textContent = this.value + '‚Ç¨'; window.guardarGastoFinanzas('otros', 'gf-otros');">
            </div>
          </div>
          <div
            style="margin-top: 15px; padding: 12px; background: rgba(255,255,255,0.2); border-radius: 10px; text-align: center;">
            <span style="color: white; font-size: 13px; font-weight: 500;">‚úì Se guardan autom√°ticamente y aparecen en el
              P&L Diario</span>
          </div>
        </div>

        <!-- Resumen R√°pido -->
        <div class="stats-grid" id="diario-resumen">
          <div class="stat-card">
            <h3>Total Compras Mes</h3>
            <div class="value" id="diario-total-compras">0.00 ‚Ç¨</div>
          </div>
          <div class="stat-card green">
            <h3>Total Ventas Mes</h3>
            <div class="value" id="diario-total-ventas">0.00 ‚Ç¨</div>
          </div>
          <div class="stat-card blue">
            <h3>Beneficio Bruto</h3>
            <div class="value" id="diario-beneficio">0.00 ‚Ç¨</div>
          </div>
          <div class="stat-card orange">
            <h3>Food Cost</h3>
            <div class="value" id="diario-food-cost">0.0%</div>
          </div>
          <div class="stat-card purple"
            style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
            <h3 style="color: rgba(255,255,255,0.9);">üí∞ Gastos Fijos Totales</h3>
            <div class="value" id="diario-gastos-fijos-total" style="color: white;">0.00 ‚Ç¨</div>
          </div>
        </div>
      </div>

      <!-- TAB: CONFIGURACI√ìN -->
      <div id="tab-configuracion" class="tab-content">
        <div class="top-bar">
          <div>
            <h2>‚öôÔ∏è Configuraci√≥n & Equipo</h2>
            <p>Gestiona los accesos y datos de tu negocio</p>
          </div>
          <button class="btn btn-secondary" onclick="window.abrirManualFormulas()">üìò Descargar/Imprimir
            Dossier</button>
        </div>

        <div class="dashboard-grid" style="grid-template-columns: 1fr; gap: 24px;">

          <!-- Tarjeta: Gesti√≥n de Equipo -->
          <div class="card"
            style="background:white; padding:20px; border-radius:16px; box-shadow:0 2px 12px rgba(0,0,0,0.08);">
            <div class="card-header"
              style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
              <h3>üë• Mi Equipo</h3>
              <button class="btn btn-primary" onclick="window.mostrarModalInvitar()">+ Invitar Usuario</button>
            </div>
            <div class="table-container">
              <table style="width:100%; border-collapse:collapse;">
                <thead>
                  <tr style="border-bottom:2px solid #eee;">
                    <th style="text-align:left; padding:10px;">Nombre</th>
                    <th style="text-align:left; padding:10px;">Email</th>
                    <th style="text-align:left; padding:10px;">Rol</th>
                    <th style="text-align:left; padding:10px;">Fecha Alta</th>
                    <th style="text-align:right; padding:10px;">Acciones</th>
                  </tr>
                </thead>
                <tbody id="lista-equipo-body">
                  <!-- Se llena con JS -->
                </tbody>
              </table>
            </div>
          </div>

          <!-- Placeholder Datos Restaurante -->
          <div class="card"
            style="background:white; padding:20px; border-radius:16px; box-shadow:0 2px 12px rgba(0,0,0,0.08);">
            <h3>üè¢ Datos del Restaurante</h3>
            <div style="margin-top:10px; color:#666;">
              <p><strong>Nombre:</strong> <span id="config-restaurante-nombre">Cargando...</span></p>
              <p style="font-size:0.9em; margin-top:5px;">ID Restaurante: <span id="config-restaurante-id">...</span>
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- MODAL INVITAR EQUIPO -->
    <div id="modal-invitar-equipo" class="modal">
      <div class="modal-content" style="max-width:500px">
        <span class="close"
          onclick="document.getElementById('modal-invitar-equipo').classList.remove('active')">&times;</span>
        <h2>Invitar Nuevo Usuario</h2>
        <div style="margin-top:20px;">
          <div class="form-group" style="margin-bottom:15px;">
            <label style="display:block; margin-bottom:5px; font-weight:bold;">Nombre Completo</label>
            <input type="text" id="team-nombre" class="form-control" placeholder="Ej. Juan Cocinero"
              style="width:100%; padding:10px; border-radius:8px; border:1px solid #ddd;">
          </div>
          <div class="form-group" style="margin-bottom:15px;">
            <label style="display:block; margin-bottom:5px; font-weight:bold;">Email Corporativo</label>
            <input type="email" id="team-email" class="form-control" placeholder="usuario@restaurante.com"
              style="width:100%; padding:10px; border-radius:8px; border:1px solid #ddd;">
          </div>
          <div class="form-group" style="margin-bottom:15px;">
            <label style="display:block; margin-bottom:5px; font-weight:bold;">Contrase√±a Inicial</label>
            <input type="password" id="team-password" class="form-control" placeholder="******"
              style="width:100%; padding:10px; border-radius:8px; border:1px solid #ddd;">
          </div>
          <div class="form-group" style="margin-bottom:20px;">
            <label style="display:block; margin-bottom:5px; font-weight:bold;">Rol</label>
            <select id="team-rol" style="width:100%; padding:10px; border-radius:8px; border:1px solid #ddd;">
              <option value="usuario">Usuario (Est√°ndar)</option>
              <option value="admin">Administrador (Acceso Total)</option>
            </select>
          </div>
          <button class="btn btn-primary" style="width:100%" onclick="window.invitarUsuarioEquipo()">Enviar
            Invitaci√≥n</button>
        </div>
      </div>
    </div>

    <!-- Modales (simplificados) -->
    <div id="modal-producir" class="modal">
      <div class="modal-content">
        <h3>Producir platos</h3>
        <p style="margin-bottom: 20px;">¬øCu√°ntas unidades de <strong id="modal-plato-nombre"></strong>?</p>
        <div class="form-group">
          <label>Cantidad</label>
          <input type="number" id="modal-cantidad" min="1" value="1" style="width:100%;padding:10px;"
            oninput="window.actualizarDetalleDescuento()">
        </div>
        <div style="margin-top: 20px; padding: 15px; background: #fef3c7; border-radius: 6px;">
          <strong>‚ö†Ô∏è Descuento de stock:</strong>
          <div id="modal-descuento-detalle" style="margin-top: 10px;"></div>
        </div>
        <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
          <button class="btn btn-secondary" onclick="window.cerrarModalProducir()">Cancelar</button>
          <button class="btn btn-success" onclick="window.confirmarProduccion()">Confirmar</button>
        </div>
      </div>
    </div>

    <div id="modal-ver-proveedor" class="modal">
      <div class="modal-content">
        <h3 id="modal-proveedor-titulo"></h3>
        <div id="modal-proveedor-contenido"></div>
        <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
          <button class="btn btn-secondary" onclick="window.cerrarModalVerProveedor()">Cerrar</button>
        </div>
      </div>
    </div>

    <!-- Modal ver detalles pedido -->
    <div id="modal-ver-pedido" class="modal">
      <div class="modal-content" style="max-width: 800px;">
        <h3>Detalles del Pedido</h3>
        <div id="modal-ver-pedido-contenido"></div>
        <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
          <button class="btn btn-secondary" onclick="window.cerrarModalVerPedido()">Cerrar</button>
          <button class="btn btn-primary" onclick="window.descargarPedidoPDF()" id="btn-descargar-pdf">
            üìÑ Descargar PDF
          </button>
        </div>
      </div>
    </div>

    <!-- Modal recibir pedido -->
    <div id="modal-recibir-pedido" class="modal">
      <div class="modal-content" style="max-width: 900px;">
        <h3>Recibir Pedido</h3>
        <p style="margin-bottom: 20px; color: #666;">
          Verifica las cantidades y precios recibidos. Puedes ajustar los valores si hay diferencias.
        </p>

        <div style="background: #f8f8f8; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
          <strong>Proveedor:</strong> <span id="modal-rec-proveedor"></span><br>
          <strong>Fecha pedido:</strong> <span id="modal-rec-fecha"></span><br>
          <strong>Total original:</strong> <span id="modal-rec-total-original"></span>
        </div>

        <div style="margin-bottom: 20px;">
          <h4 style="margin-bottom: 10px;">Ingredientes del pedido:</h4>
          <table style="font-size: 13px;">
            <thead>
              <tr>
                <th>Ingrediente</th>
                <th>Pedido</th>
                <th>Recibido</th>
                <th>Precio Ped.</th>
                <th>Precio Real</th>
                <th>Subtotal</th>
                <th>Estado</th>
              </tr>
            </thead>
            <tbody id="modal-rec-items"></tbody>
          </table>
        </div>

        <div
          style="background: #f0fdf4; border: 2px solid #10b981; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
          <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px;">
            <div>
              <strong style="color: #666;">Total Original:</strong><br>
              <span style="font-size: 20px; font-weight: bold; color: #333;" id="modal-rec-resumen-original">0.00
                ‚Ç¨</span>
            </div>
            <div>
              <strong style="color: #666;">Total Recibido:</strong><br>
              <span style="font-size: 20px; font-weight: bold; color: #059669;" id="modal-rec-resumen-recibido">0.00
                ‚Ç¨</span>
            </div>
            <div>
              <strong style="color: #666;">Varianza:</strong><br>
              <span style="font-size: 20px; font-weight: bold;" id="modal-rec-resumen-varianza">0.00 ‚Ç¨</span>
            </div>
          </div>
        </div>

        <div style="display: flex; gap: 10px; justify-content: flex-end;">
          <button class="btn btn-secondary" onclick="window.cerrarModalRecibirPedido()">Cancelar</button>
          <button class="btn btn-success" onclick="window.confirmarRecepcionPedido()">Confirmar Recepci√≥n</button>
        </div>
      </div>
    </div>

    <script src="src/legacy/app-core.js"></script>
    <!-- Toast Container -->
    <div class="toast-container" id="toast-container"></div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loading-overlay">
      <div class="spinner"></div>
    </div>

    <!-- Modal: Confirmar Mermas Avanzado -->
    <div id="modal-confirmar-mermas" class="modal">
      <div class="modal-content" style="max-width: 800px;">
        <span class="close"
          onclick="document.getElementById('modal-confirmar-mermas').classList.remove('active')">&times;</span>
        <h2 style="color: #ef4444; display: flex; align-items: center; gap: 10px;">‚ö†Ô∏è Confirmar Mermas/P√©rdidas</h2>
        <p style="color: #64748b; margin-bottom: 20px;">Se han detectado diferencias negativas en el inventario. Por
          favor, especifica el motivo de cada p√©rdida para el control de costes.</p>

        <div style="max-height: 400px; overflow-y: auto; border: 1px solid #e2e8f0; border-radius: 8px;">
          <table style="width: 100%; border-collapse: collapse;">
            <thead style="background: #f8fafc; position: sticky; top: 0;">
              <tr>
                <th style="padding: 10px; text-align: left; border-bottom: 2px solid #e2e8f0;">Ingrediente</th>
                <th style="padding: 10px; text-align: left; border-bottom: 2px solid #e2e8f0;">Diferencia</th>
                <th style="padding: 10px; text-align: left; border-bottom: 2px solid #e2e8f0;">Motivo</th>
                <th style="padding: 10px; text-align: left; border-bottom: 2px solid #e2e8f0;">Notas</th>
              </tr>
            </thead>
            <tbody id="tabla-mermas-body">
              <!-- Se llena din√°micamente -->
            </tbody>
          </table>
        </div>

        <div id="mermas-alert-box"
          style="display:none; margin-top: 10px; padding: 10px; background: #fee2e2; color: #b91c1c; border-radius: 6px; font-size: 13px;">
        </div>

        <div style="margin-top: 20px; display: flex; justify-content: flex-end; gap: 10px;">
          <button class="btn btn-secondary"
            onclick="document.getElementById('modal-confirmar-mermas').classList.remove('active')">Cancelar</button>
          <button class="btn btn-primary" id="btn-confirmar-split" style="background: #ef4444;"
            onclick="window.confirmarMermasFinal()">Confirmar Ajustes</button>
        </div>
      </div>
    </div>
    <!-- Modal: Actualizar Inventario Masivo -->
    <div id="modal-inventario-masivo" class="modal">
      <div class="modal-content" style="max-width: 900px;">
        <span class="close"
          onclick="document.getElementById('modal-inventario-masivo').classList.remove('active')">&times;</span>
        <h2>üìä Actualizar Inventario Masivo</h2>

        <div style="margin: 20px 0;">
          <p style="color: #64748b; margin-bottom: 15px;">
            Sube un archivo Excel (.xlsx) o CSV con las columnas: <strong>Ingrediente</strong> y <strong>Stock
              Real</strong>
          </p>

          <div style="text-align: right; margin-bottom: 10px;">
            <button class="btn btn-secondary btn-small" onclick="window.descargarPlantillaStock()">üì• Descargar
              Plantilla</button>
          </div>

          <div
            style="border: 2px dashed #cbd5e1; border-radius: 8px; padding: 30px; text-align: center; background: #f8fafc;">
            <input type="file" id="file-inventario-masivo" accept=".xlsx,.csv" style="display: none;"
              onchange="window.procesarArchivoInventario(this)">
            <label for="file-inventario-masivo" style="cursor: pointer;">
              <div style="font-size: 48px; margin-bottom: 10px;">üìÅ</div>
              <div style="font-size: 16px; color: #475569; font-weight: 500;">Haz clic para seleccionar archivo
              </div>
              <div style="font-size: 14px; color: #94a3b8; margin-top: 5px;">Excel (.xlsx) o CSV</div>
            </label>
          </div>
        </div>

        <div id="preview-inventario-masivo" style="display: none; margin-top: 20px;">
          <h3>Vista Previa de Cambios</h3>
          <div id="preview-table-container"
            style="max-height: 400px; overflow-y: auto; border: 1px solid #e2e8f0; border-radius: 8px;"></div>

          <div style="margin-top: 20px; display: flex; gap: 10px; justify-content: flex-end;">
            <button class="btn btn-secondary" onclick="window.cancelarInventarioMasivo()">Cancelar</button>
            <button class="btn btn-primary" onclick="window.confirmarInventarioMasivo()" id="btn-confirmar-masivo">‚úì
              Confirmar Actualizaci√≥n</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal: Importar Ingredientes -->
    <div id="modal-importar-ingredientes" class="modal">
      <div class="modal-content" style="max-width: 900px;">
        <span class="close"
          onclick="document.getElementById('modal-importar-ingredientes').classList.remove('active')">&times;</span>
        <h2>üì§ Importar Ingredientes desde Excel</h2>

        <div style="margin: 20px 0;">
          <p style="color: #64748b; margin-bottom: 15px;">
            Sube un archivo Excel (.xlsx) o CSV con las columnas: <strong>Nombre</strong>, <strong>Precio</strong>,
            <strong>Unidad</strong>, <strong>Stock Actual</strong>, <strong>Stock M√≠nimo</strong>
          </p>

          <div
            style="border: 2px dashed #cbd5e1; border-radius: 8px; padding: 30px; text-align: center; background: #f8fafc;">
            <input type="file" id="file-importar-ingredientes" accept=".xlsx,.csv" style="display: none;"
              onchange="window.procesarArchivoIngredientes(this)">
            <label for="file-importar-ingredientes" style="cursor: pointer;">
              <div style="font-size: 48px; margin-bottom: 10px;">üìÅ</div>
              <div style="font-size: 16px; color: #475569; font-weight: 500;">Haz clic para seleccionar archivo
              </div>
              <div style="font-size: 14px; color: #94a3b8; margin-top: 5px;">Excel (.xlsx) o CSV</div>
            </label>
          </div>
        </div>

        <div id="preview-importar-ingredientes" style="display: none; margin-top: 20px;">
          <h3>Vista Previa de Ingredientes</h3>
          <div id="preview-ingredientes-container"
            style="max-height: 400px; overflow-y: auto; border: 1px solid #e2e8f0; border-radius: 8px;"></div>

          <div style="margin-top: 20px; display: flex; gap: 10px; justify-content: flex-end;">
            <button class="btn btn-secondary" onclick="window.cancelarImportarIngredientes()">Cancelar</button>
            <button class="btn btn-primary" onclick="window.confirmarImportarIngredientes()"
              id="btn-confirmar-importar-ingredientes">‚úì Importar Ingredientes</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal: Importar Recetas -->
    <div id="modal-importar-recetas" class="modal">
      <div class="modal-content" style="max-width: 900px;">
        <span class="close"
          onclick="document.getElementById('modal-importar-recetas').classList.remove('active')">&times;</span>
        <h2>üì§ Importar Recetas desde Excel</h2>

        <div style="margin: 20px 0;">
          <p style="color: #64748b; margin-bottom: 15px;">
            Sube un archivo Excel (.xlsx) o CSV con las columnas: <strong>Nombre</strong>,
            <strong>Categor√≠a</strong>,
            <strong>Precio Venta</strong>, <strong>Porciones</strong>
          </p>

          <div
            style="border: 2px dashed #cbd5e1; border-radius: 8px; padding: 30px; text-align: center; background: #f8fafc;">
            <input type="file" id="file-importar-recetas" accept=".xlsx,.csv" style="display: none;"
              onchange="window.procesarArchivoRecetas(this)">
            <label for="file-importar-recetas" style="cursor: pointer;">
              <div style="font-size: 48px; margin-bottom: 10px;">üìÅ</div>
              <div style="font-size: 16px; color: #475569; font-weight: 500;">Haz clic para seleccionar archivo
              </div>
              <div style="font-size: 14px; color: #94a3b8; margin-top: 5px;">Excel (.xlsx) o CSV</div>
            </label>
          </div>
        </div>

        <div id="preview-importar-recetas" style="display: none; margin-top: 20px;">
          <h3>Vista Previa de Recetas</h3>
          <div id="preview-recetas-container"
            style="max-height: 400px; overflow-y: auto; border: 1px solid #e2e8f0; border-radius: 8px;"></div>

          <div style="margin-top: 20px; display: flex; gap: 10px; justify-content: flex-end;">
            <button class="btn btn-secondary" onclick="window.cancelarImportarRecetas()">Cancelar</button>
            <button class="btn btn-primary" onclick="window.confirmarImportarRecetas()"
              id="btn-confirmar-importar-recetas">‚úì Importar Recetas</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal: Importar Ventas TPV -->
    <div id="modal-importar-ventas" class="modal">
      <div class="modal-content" style="max-width: 900px;">
        <span class="close"
          onclick="document.getElementById('modal-importar-ventas').classList.remove('active')">&times;</span>
        <h2>üì§ Importar Ventas TPV</h2>

        <div style="margin: 20px 0;">
          <p style="color: #64748b; margin-bottom: 15px;">
            Sube un archivo Excel (.xlsx) o CSV con las columnas: <strong>C√≥digo</strong> (opcional),
            <strong>Nombre</strong>, <strong>Cantidad</strong>, <strong>Total</strong>
          </p>

          <div
            style="border: 2px dashed #cbd5e1; border-radius: 8px; padding: 30px; text-align: center; background: #f8fafc;">
            <input type="file" id="file-importar-ventas" accept=".xlsx,.csv" style="display: none;"
              onchange="window.procesarArchivoVentas(this)">
            <label for="file-importar-ventas" style="cursor: pointer;">
              <div style="font-size: 48px; margin-bottom: 10px;">üìÅ</div>
              <div style="font-size: 16px; color: #475569; font-weight: 500;">Haz clic para seleccionar archivo
              </div>
              <div style="font-size: 14px; color: #94a3b8; margin-top: 5px;">Excel (.xlsx) o CSV</div>
            </label>
          </div>
        </div>

        <div id="preview-importar-ventas" style="display: none; margin-top: 20px;">
          <h3>Vista Previa de Ventas</h3>
          <div id="preview-ventas-container"
            style="max-height: 400px; overflow-y: auto; border: 1px solid #e2e8f0; border-radius: 8px;"></div>

          <div style="margin-top: 20px; display: flex; gap: 10px; justify-content: flex-end;">
            <button class="btn btn-secondary" onclick="window.cancelarImportarVentas()">Cancelar</button>
            <button class="btn btn-primary" onclick="window.confirmarImportarVentas()"
              id="btn-confirmar-importar-ventas">‚úì Importar Ventas</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal: Importar Pedidos (Compras) -->
    <div id="modal-importar-pedidos" class="modal">
      <div class="modal-content" style="max-width: 900px;">
        <span class="close"
          onclick="document.getElementById('modal-importar-pedidos').classList.remove('active')">&times;</span>
        <h2>üì§ Importar Pedidos (Compras)</h2>

        <div style="margin: 20px 0;">
          <p style="color: #64748b; margin-bottom: 15px;">
            Sube un archivo Excel (.xlsx) o CSV con las columnas: <strong>Fecha</strong>,
            <strong>Proveedor</strong>,
            <strong>Ingrediente</strong>, <strong>Cantidad</strong>, <strong>Precio</strong>, <strong>Total</strong>
          </p>

          <div
            style="border: 2px dashed #cbd5e1; border-radius: 8px; padding: 30px; text-align: center; background: #f8fafc;">
            <input type="file" id="file-importar-pedidos" accept=".xlsx,.csv" style="display: none;"
              onchange="window.procesarArchivoPedidos(this)">
            <label for="file-importar-pedidos" style="cursor: pointer;">
              <div style="font-size: 48px; margin-bottom: 10px;">üìÅ</div>
              <div style="font-size: 16px; color: #475569; font-weight: 500;">Haz clic para seleccionar archivo
              </div>
              <div style="font-size: 14px; color: #94a3b8; margin-top: 5px;">Excel (.xlsx) o CSV</div>
            </label>
          </div>
        </div>

        <div id="preview-importar-pedidos" style="display: none; margin-top: 20px;">
          <h3>Vista Previa de Pedidos</h3>
          <div id="preview-pedidos-container"
            style="max-height: 400px; overflow-y: auto; border: 1px solid #e2e8f0; border-radius: 8px;"></div>

          <div style="margin-top: 20px; display: flex; gap: 10px; justify-content: flex-end;">
            <button class="btn btn-secondary" onclick="window.cancelarImportarPedidos()">Cancelar</button>
            <button class="btn btn-primary" onclick="window.confirmarImportarPedidos()"
              id="btn-confirmar-importar-pedidos">‚úì Importar Pedidos</button>
          </div>
        </div>
      </div>
    </div>
    </script>
  </div>
    <script src="src/legacy/inventario-masivo.js"></script>
  <!-- MODAL DE CONFIRMACI√ìN PROFESIONAL -->
  <div id="modal-confirmacion" class="modal-overlay-custom" style="display: none;">
    <div class="modal-confirmacion-container">
      <div class="modal-confirmacion-content">
        <div class="modal-header-danger">
          <span class="modal-danger-icon">‚ö†Ô∏è</span>
          <h3 id="confirm-titulo">Confirmar Eliminaci√≥n</h3>
        </div>
        <div class="modal-confirmacion-body">
          <p id="confirm-mensaje"></p>
        </div>
        <div class="modal-confirmacion-footer">
          <button class="btn-modal-cancel" onclick="window.cerrarConfirmacion()">
            <span>‚úñ</span> Cancelar
          </button>
          <button class="btn-modal-danger" id="btn-confirmar-eliminar">
            <span>üóëÔ∏è</span> Eliminar
          </button>
        </div>
      </div>
    </div>
  </div>
  <style>
    <!-- Modal Gasto Fijo 
    -->
  <div id="modal-gasto-fijo" class="modal">
    <div class="modal-content">
      <span class="close" onclick="cerrarFormularioGastoFijo()">&times;</span>
      <h2 id="titulo-modal-gasto">A√±adir Gasto Fijo</h2>

      <form id="form-gasto-fijo" onsubmit="guardarGastoFijo(event)">
        <input type="hidden" id="gasto-id">

        <div class="form-group">
          <label for="gasto-concepto">Concepto *</label>
          <input type="text" id="gasto-concepto" required placeholder="ej: Alquiler, N√≥minas, Luz...">
        </div>

        <div class="form-group">
          <label for="gasto-monto">Monto Mensual (‚Ç¨) *</label>
          <input type="number" id="gasto-monto" step="0.01" min="0" required placeholder="0.00">
        </div>

        <div style="display:flex;gap:10px;margin-top:20px">
          <button type="submit" class="btn-primary">Guardar</button>
          <button type="button" class="btn-secondary" onclick="cerrarFormularioGastoFijo()">Cancelar</button>
        </div>
      </form>
    </div>
  </div>
  .modal-overlay-custom {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  background: rgba(0, 0, 0, 0.7);
  backdrop-filter: blur(8px);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 99999;
  animation: fadeInModal 0.2s cubic-bezier(0.16, 1, 0.3, 1);
  }
  @keyframes fadeInModal {
  from { opacity: 0; backdrop-filter: blur(0); }
  to { opacity: 1; backdrop-filter: blur(8px); }
  }
  .modal-confirmacion-container {
  animation: slideUpBounce 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
  }
  @keyframes slideUpBounce {
  0% { transform: translateY(100px) scale(0.8); opacity: 0; }
  100% { transform: translateY(0) scale(1); opacity: 1; }
  }
  .modal-confirmacion-content {
  background: white;
  border-radius: 16px;
  box-shadow: 0 25px 80px rgba(0, 0, 0, 0.4);
  max-width: 520px;
  width: 92%;
  overflow: hidden;
  }
  .modal-header-danger {
  background: linear-gradient(145deg, #ff4444 0%, #cc0000 100%);
  color: white;
  padding: 28px 32px;
  display: flex;
  align-items: center;
  gap: 16px;
  }
  .modal-danger-icon {
  font-size: 2.5rem;
  animation: shake 0.5s ease-in-out;
  }
  @keyframes shake {
  0%, 100% { transform: translateX(0); }
  25% { transform: translateX(-10px); }
  75% { transform: translateX(10px); }
  }
  .modal-header-danger h3 {
  margin: 0;
  font-size: 1.35rem;
  font-weight: 700;
  }
  .modal-confirmacion-body {
  padding: 32px;
  font-size: 1.05rem;
  line-height: 1.6;
  color: #2c3e50;
  }
  .modal-confirmacion-body strong {
  color: #ff4444;
  font-weight: 700;
  }
  .modal-confirmacion-footer {
  padding: 20px 32px 28px;
  border-top: 1px solid #ecf0f1;
  display: flex;
  justify-content: flex-end;
  gap: 12px;
  background: #f8f9fa;
  }
  .btn-modal-cancel, .btn-modal-danger {
  padding: 12px 28px;
  border-radius: 8px;
  font-weight: 600;
  font-size: 0.95rem;
  cursor: pointer;
  border: none;
  display: flex;
  align-items: center;
  gap: 8px;
  transition: all 0.2s cubic-bezier(0.34, 1.56, 0.64, 1);
  }
  .btn-modal-cancel {
  background: white;
  color: #495057;
  border: 2px solid #dee2e6;
  }
  .btn-modal-cancel:hover {
  background: #f8f9fa;
  border-color: #adb5bd;
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  }
  .btn-modal-danger {
  background: linear-gradient(145deg, #ff4444 0%, #cc0000 100%);
  color: white;
  box-shadow: 0 4px 12px rgba(255, 68, 68, 0.3);
  }
  .btn-modal-danger:hover {
  transform: translateY(-3px);
  box-shadow: 0 8px 20px rgba(255, 68, 68, 0.4);
  }
  </style>
    <script src="src/legacy/modales.js"></script>
</body>

</html>