(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))e(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&e(a)}).observe(document,{childList:!0,subtree:!0});function o(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function e(i){if(i.ep)return;i.ep=!0;const r=o(i);fetch(i.href,r)}})();function m(n,t="success"){const o=document.getElementById("toast-container");if(!o){console.error("toast-container no encontrado en DOM");return}const e=document.createElement("div");e.className=`toast ${t}`;const i={success:"‚úÖ",error:"‚ùå",warning:"‚ö†Ô∏è",info:"‚ÑπÔ∏è"};e.innerHTML=`
    <div class="toast-icon">${i[t]||i.info}</div>
    <div class="toast-message"></div>
    <div class="toast-progress"></div>
  `;const r=e.querySelector(".toast-message");r&&(r.textContent=n),e.style.cssText=`
    animation: slideInDown 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
    box-shadow: 0 8px 30px rgba(0, 0, 0, 0.15);
    border-radius: 12px;
    backdrop-filter: blur(10px);
  `;const a=e.querySelector(".toast-progress");a&&(a.style.cssText=`
      position: absolute;
      bottom: 0;
      left: 0;
      height: 4px;
      background: ${t==="success"?"#10b981":t==="error"?"#ef4444":"#f59e0b"};
      width: 100%;
      animation: progressShrink 3s linear;
      border-radius: 0 0 12px 12px;
    `),o.appendChild(e),setTimeout(()=>{e.style.animation="slideOutUp 0.4s cubic-bezier(0.4, 0, 1, 1)",setTimeout(()=>e.remove(),400)},3e3)}if(!document.getElementById("toast-animations")){const n=document.createElement("style");n.id="toast-animations",n.textContent=`
    @keyframes slideInDown {
      from {
        transform: translateY(-100px);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }
    @keyframes slideOutUp {
      from {
        transform: translateY(0);
        opacity: 1;
      }
      to {
        transform: translateY(-100px);
        opacity: 0;
      }
    }
    @keyframes progressShrink {
      from { width: 100%; }
      to { width: 0%; }
    }
  `,document.head.appendChild(n)}function l(n,t=""){const o=document.getElementById(n);return!o&&t&&console.warn(`[DOM] Elemento '${n}' no encontrado en contexto: ${t}`),o}function z(n,t,o=""){const e=l(n);e?e.textContent=t:o&&console.warn(`[DOM] No se pudo establecer texto en '${n}', usando fallback`)}function q(n,t){const o=l(n);o&&(o.innerHTML=t)}function p(n){const t=l(n);return t?t.value:""}function N(n,t){const o=l(n);o&&(o.value=t)}function O(n,t){const o=l(n);o&&o.classList.add(t)}function H(n,t){const o=l(n);o&&o.classList.remove(t)}function V(n,t){const o=l(n);o&&o.classList.toggle(t)}function j(n){const t=l(n);t&&(t.style.display="block")}function X(n){const t=l(n);t&&(t.style.display="none")}const $=Object.freeze(Object.defineProperty({__proto__:null,addElementClass:O,getElement:l,getInputValue:p,hideElement:X,removeElementClass:H,setElementHTML:q,setElementText:z,setInputValue:N,showElement:j,toggleElementClass:V},Symbol.toStringTag,{value:"Module"}));function h(n,t="success"){const o=document.getElementById("toast-container");if(!o){console.warn("[Toast] Contenedor toast-container no encontrado");return}const e=document.createElement("div");e.className=`toast ${t}`;const i={success:"‚úÖ",error:"‚ùå",warning:"‚ö†Ô∏è",info:"‚ÑπÔ∏è"};e.innerHTML=`
        <div class="toast-icon">${i[t]||"‚ÑπÔ∏è"}</div>
        <div class="toast-message"></div>
    `,e.querySelector(".toast-message").textContent=n,o.appendChild(e),setTimeout(()=>{e.style.animation="slideIn 0.3s ease reverse",setTimeout(()=>e.remove(),300)},3e3)}function C(){const n=document.getElementById("loading-overlay");n&&n.classList.add("active")}function S(){const n=document.getElementById("loading-overlay");n&&n.classList.remove("active")}function L(n,t,o){if(typeof XLSX>"u"){console.error("[Excel] SheetJS (XLSX) no est√° cargado"),h("Error: Librer√≠a Excel no disponible","error");return}if(!n||!Array.isArray(n)||n.length===0){h("No hay datos para exportar","warning");return}try{const e=n.map(d=>{const c={};return o.forEach(s=>{c[s.header]=s.key?d[s.key]:s.value(d)}),c}),i=XLSX.utils.book_new(),r=XLSX.utils.json_to_sheet(e);r["!cols"]=o.map(()=>({wch:20})),XLSX.utils.book_append_sheet(i,r,"Datos");const a=new Date().toISOString().split("T")[0];XLSX.writeFile(i,`${t}_${a}.xlsx`),h("Excel descargado correctamente","success")}catch(e){console.error("[Excel] Error exportando:",e),h("Error al exportar Excel","error")}}function T(n){return(parseFloat(n)||0).toFixed(2).replace(".",",")+"‚Ç¨"}function k(n){return n?new Date(n).toLocaleDateString("es-ES"):"-"}function U(n){return n?new Date(n).toLocaleString("es-ES"):"-"}function G(n,t=300){let o;return function(...i){const r=()=>{clearTimeout(o),n(...i)};clearTimeout(o),o=setTimeout(r,t)}}typeof window<"u"&&(window.showToast=h,window.showLoading=C,window.hideLoading=S,window.exportarAExcel=L,window.formatCurrency=T,window.formatDate=k,window.formatDateTime=U,window.debounce=G);function K(){var r,a;const n=((a=(r=l("busqueda-ingredientes"))==null?void 0:r.value)==null?void 0:a.toLowerCase())||"",t=window.ingredientes||[],o=window.proveedores||[],e=t.filter(d=>{const c=F(d.proveedor_id,o).toLowerCase();return d.nombre.toLowerCase().includes(n)||c.includes(n)}),i=l("tabla-ingredientes");if(i)if(e.length===0){i.innerHTML=`
      <div class="empty-state">
        <div class="icon">üì¶</div>
        <h3>${n?"No encontrados":"A√∫n no hay ingredientes"}</h3>
        <p>${n?"Prueba otra b√∫squeda":"A√±ade tu primer ingrediente"}</p>
      </div>
    `;const d=l("resumen-ingredientes");d&&(d.style.display="none")}else{let d="<table><thead><tr>";d+="<th>Ingrediente</th><th>Proveedor</th><th>Precio</th><th>Stock</th><th>Stock M√≠nimo</th>",d+="</tr></thead><tbody>",e.forEach(s=>{const u=parseFloat(s.stock_actual)||0,w=parseFloat(s.stock_minimo)||0,g=w>0&&u<=w;d+="<tr>",d+=`<td><strong style="cursor: pointer;" onclick="window.editarIngrediente(${s.id})">${s.nombre}</strong></td>`,d+=`<td>${F(s.proveedor_id,o)}</td>`,d+=`<td>${s.precio?parseFloat(s.precio).toFixed(2)+" ‚Ç¨/"+s.unidad:"-"}</td>`,d+="<td>",s.stock_actual?(d+=`<span class="stock-badge ${g?"stock-low":"stock-ok"}">${s.stock_actual} ${s.unidad}</span>`,g&&s.stock_minimo&&(d+=" ‚ö†Ô∏è")):d+="-",d+="</td>",d+=`<td>${s.stock_minimo?parseFloat(s.stock_minimo)+" "+s.unidad:"-"}</td>`,d+="</tr>"}),d+="</tbody></table>",i.innerHTML=d;const c=l("resumen-ingredientes");c&&(c.innerHTML=`
        <div>Total: <strong>${t.length}</strong></div>
        <div>Mostrando: <strong>${e.length}</strong></div>
      `,c.style.display="flex")}}function Y(){J();const n=l("formulario-ingrediente");if(n){n.style.display="block";const t=l("ing-nombre");t&&t.focus()}}function W(){const n=l("formulario-ingrediente");if(n){n.style.display="none";const e=n.querySelector("form");e&&e.reset()}const t=l("form-title-ingrediente");t&&(t.textContent="Nuevo Ingrediente");const o=l("btn-text-ingrediente");o&&(o.textContent="A√±adir")}function J(){const n=l("ing-proveedor-select");if(!n)return;const t=window.proveedores||[];n.innerHTML='<option value="">Sin proveedor</option>',t.forEach(o=>{n.innerHTML+=`<option value="${o.id}">${o.nombre}</option>`})}function F(n,t=null){const e=(t||window.proveedores||[]).find(i=>i.id===n);return e?e.nombre:"Sin proveedor"}function Q(){if(typeof window.exportarAExcel!="function"){m("Exportaci√≥n no disponible","error");return}const n=[{header:"Nombre",key:"nombre"},{header:"Categor√≠a",key:"categoria"},{header:"Proveedor",value:t=>{const o=(window.proveedores||[]).find(e=>e.id===t.proveedor_id);return o?o.nombre:"Sin proveedor"}},{header:"Precio (‚Ç¨)",value:t=>parseFloat(t.precio||0).toFixed(2)},{header:"Unidad",key:"unidad"},{header:"Stock Actual",value:t=>parseFloat(t.stock_actual||0).toFixed(2)},{header:"Stock M√≠nimo",value:t=>parseFloat(t.stock_minimo||0).toFixed(2)}];window.exportarAExcel(window.ingredientes||[],"Ingredientes_CostOS",n)}async function Z(n){n.preventDefault();const t={nombre:p("ing-nombre"),proveedorId:p("ing-proveedor-select")||null,precio:parseFloat(p("ing-precio"))||0,unidad:p("ing-unidad"),stockActual:parseFloat(p("ing-stockActual"))||0,stockMinimo:parseFloat(p("ing-stockMinimo"))||0};if(!t.nombre||t.nombre.trim()===""){m("El nombre es obligatorio","error");return}if(t.precio<0){m("El precio no puede ser negativo","error");return}if(t.stockActual<0){m("El stock no puede ser negativo","error");return}if(t.stockMinimo<0){m("El stock m√≠nimo no puede ser negativo","error");return}typeof window.showLoading=="function"&&window.showLoading();try{const o=window.editandoIngredienteId;let e;if(o!==null?(await window.api.updateIngrediente(o,t),e=o):e=(await window.api.createIngrediente(t)).id,t.proveedorId){const r=(window.proveedores||[]).find(a=>a.id===parseInt(t.proveedorId));if(r){const a=r.ingredientes||[];a.includes(e)||(a.push(e),await window.api.updateProveedor(r.id,{...r,ingredientes:a}))}}await window.cargarDatos(),window.renderizarIngredientes(),typeof window.renderizarInventario=="function"&&window.renderizarInventario(),typeof window.actualizarKPIs=="function"&&window.actualizarKPIs(),typeof window.actualizarDashboardExpandido=="function"&&window.actualizarDashboardExpandido(),typeof window.hideLoading=="function"&&window.hideLoading(),m(o?"Ingrediente actualizado":"Ingrediente creado","success"),window.cerrarFormularioIngrediente()}catch(o){typeof window.hideLoading=="function"&&window.hideLoading(),console.error("Error:",o),m("Error guardando ingrediente: "+o.message,"error")}}function ee(n){const o=(window.ingredientes||[]).find(w=>w.id===n);if(!o)return;typeof window.actualizarSelectProveedores=="function"&&window.actualizarSelectProveedores();const e=l("ing-nombre");e&&(e.value=o.nombre);const i=l("ing-proveedor-select");i&&(i.value=o.proveedorId||"");const r=l("ing-precio");r&&(r.value=o.precio||"");const a=l("ing-unidad");a&&(a.value=o.unidad);const d=l("ing-stockActual");d&&(d.value=o.stockActual||"");const c=l("ing-stockMinimo");c&&(c.value=o.stockMinimo||""),window.editandoIngredienteId=n;const s=l("form-title-ingrediente");s&&(s.textContent="Editar Ingrediente");const u=l("btn-text-ingrediente");u&&(u.textContent="Guardar"),window.mostrarFormularioIngrediente()}async function te(n){if(confirm("¬øEliminar este ingrediente?")){typeof window.showLoading=="function"&&window.showLoading();try{await window.api.deleteIngrediente(n),await window.cargarDatos(),window.renderizarIngredientes(),typeof window.renderizarInventario=="function"&&window.renderizarInventario(),typeof window.actualizarKPIs=="function"&&window.actualizarKPIs(),typeof window.actualizarDashboardExpandido=="function"&&window.actualizarDashboardExpandido(),typeof window.hideLoading=="function"&&window.hideLoading(),m("Ingrediente eliminado","success")}catch(t){typeof window.hideLoading=="function"&&window.hideLoading(),console.error("Error:",t),m("Error eliminando ingrediente: "+t.message,"error")}}}function oe(){if(window.ingredientes.length===0){window.showToast("Primero a√±ade ingredientes","warning"),window.cambiarTab("ingredientes"),window.mostrarFormularioIngrediente();return}document.getElementById("formulario-receta").style.display="block",window.agregarIngredienteReceta(),document.getElementById("rec-nombre").focus()}function ne(){document.getElementById("formulario-receta").style.display="none",document.querySelector("#formulario-receta form").reset(),document.getElementById("lista-ingredientes-receta").innerHTML="",document.getElementById("coste-calculado-form").style.display="none",window.editandoRecetaId=null,document.getElementById("rec-nombre").value="",document.getElementById("rec-codigo").value="",document.getElementById("rec-categoria").value="entrante",document.getElementById("rec-precio_venta").value="",document.getElementById("rec-porciones").value="1",document.getElementById("lista-ingredientes-receta").innerHTML="",document.getElementById("form-title-receta").textContent="Nueva Receta",document.getElementById("btn-text-receta").textContent="Guardar"}function ie(){const n=document.getElementById("lista-ingredientes-receta"),t=document.createElement("div");t.className="ingrediente-item",t.style.cssText="display: flex; gap: 10px; align-items: center; margin-bottom: 10px; padding: 10px; background: #f8f9fa; border-radius: 8px;";let o='<option value="">Selecciona ingrediente...</option>';window.ingredientes.forEach(e=>{o+=`<option value="${e.id}">${e.nombre} (${parseFloat(e.precio||0).toFixed(2)}‚Ç¨/${e.unidad})</option>`}),t.innerHTML=`
    <select style="flex: 2; padding: 8px; border: 1px solid #ddd; border-radius: 6px;" onchange="window.calcularCosteReceta()">
      ${o}
    </select>
    <input type="number" step="0.01" min="0" placeholder="Cantidad" style="flex: 1; padding: 8px; border: 1px solid #ddd; border-radius: 6px;" onchange="window.calcularCosteReceta()">
    <button type="button" onclick="this.parentElement.remove(); window.calcularCosteReceta();" style="background: #ef4444; color: white; border: none; padding: 8px 12px; border-radius: 6px; cursor: pointer;">‚úï</button>
  `,n.appendChild(t)}function re(){var e;const n=document.querySelectorAll("#lista-ingredientes-receta .ingrediente-item");let t=0;n.forEach(i=>{const r=i.querySelector("select"),a=i.querySelector("input");if(r.value&&a.value){const d=window.ingredientes.find(c=>c.id===parseInt(r.value));d&&(t+=parseFloat(d.precio||0)*parseFloat(a.value||0))}});const o=document.getElementById("coste-calculado-form");if(o){o.style.display=t>0?"block":"none";const i=document.getElementById("coste-receta-valor");i&&(i.textContent=t.toFixed(2)+"‚Ç¨");const r=parseFloat(((e=document.getElementById("rec-precio_venta"))==null?void 0:e.value)||0),a=document.getElementById("margen-receta-valor");if(a&&r>0){const d=(r-t)/r*100;a.textContent=d.toFixed(1)+"%",a.style.color=d>=60?"#10b981":d>=40?"#f59e0b":"#ef4444"}}return t}function de(){const n=document.getElementById("busqueda-recetas").value.toLowerCase(),t=window.recetas.filter(e=>e.nombre.toLowerCase().includes(n)||e.codigo&&e.codigo.toString().includes(n)),o=document.getElementById("tabla-recetas");if(t.length===0)o.innerHTML=`
      <div class="empty-state">
        <div class="icon">üë®‚Äçüç≥</div>
        <h3>${n?"No encontradas":"A√∫n no hay recetas"}</h3>
      </div>
    `,document.getElementById("resumen-recetas").style.display="none";else{let e="<table><thead><tr>";e+="<th>C√≥d.</th><th>Plato</th><th>Categor√≠a</th><th>Coste</th><th>Precio</th><th>Margen</th><th>Acciones</th>",e+="</tr></thead><tbody>",t.forEach(i=>{const r=window.calcularCosteRecetaCompleto(i),a=i.precio_venta-r,d=i.precio_venta>0?(a/i.precio_venta*100).toFixed(0):0;e+="<tr>",e+=`<td><span style="color:#666;font-size:12px;">${i.codigo||"-"}</span></td>`,e+=`<td><strong>${i.nombre}</strong></td>`,e+=`<td><span class="badge badge-success">${i.categoria}</span></td>`,e+=`<td>${r.toFixed(2)} ‚Ç¨</td>`,e+=`<td>${i.precio_venta?parseFloat(i.precio_venta).toFixed(2):"0.00"} ‚Ç¨</td>`,e+=`<td><span class="badge ${a>0?"badge-success":"badge-warning"}">${a.toFixed(2)} ‚Ç¨ (${d}%)</span></td>`,e+='<td><div class="actions">',e+=`<button class="icon-btn produce" onclick="window.abrirModalProducir(${i.id})">‚¨áÔ∏è</button>`,e+=`<button class="icon-btn edit" onclick="window.editarReceta(${i.id})">‚úèÔ∏è</button>`,e+=`<button class="icon-btn delete" onclick="window.eliminarReceta(${i.id})">üóëÔ∏è</button>`,e+="</div></td>",e+="</tr>"}),e+="</tbody></table>",o.innerHTML=e,document.getElementById("resumen-recetas").innerHTML=`
      <div>Total: <strong>${window.recetas.length}</strong></div>
      <div>Mostrando: <strong>${t.length}</strong></div>
    `,document.getElementById("resumen-recetas").style.display="flex"}}function ae(){const n=[{header:"ID",key:"id"},{header:"C√≥digo",value:t=>t.codigo||`REC-${String(t.id).padStart(4,"0")}`},{header:"Nombre",key:"nombre"},{header:"Categor√≠a",key:"categoria"},{header:"Precio Venta (‚Ç¨)",value:t=>parseFloat(t.precio_venta||0).toFixed(2)},{header:"Coste (‚Ç¨)",value:t=>(t.ingredientes||[]).reduce((o,e)=>{const i=window.ingredientes.find(r=>r.id===e.ingredienteId);return o+(i?parseFloat(i.precio)*parseFloat(e.cantidad):0)},0).toFixed(2)},{header:"Margen (‚Ç¨)",value:t=>{const o=(t.ingredientes||[]).reduce((e,i)=>{const r=window.ingredientes.find(a=>a.id===i.ingredienteId);return e+(r?parseFloat(r.precio)*parseFloat(i.cantidad):0)},0);return(parseFloat(t.precio_venta||0)-o).toFixed(2)}},{header:"Margen (%)",value:t=>{const o=(t.ingredientes||[]).reduce((i,r)=>{const a=window.ingredientes.find(d=>d.id===r.ingredienteId);return i+(a?parseFloat(a.precio)*parseFloat(r.cantidad):0)},0);return(t.precio_venta>0?(parseFloat(t.precio_venta)-o)/parseFloat(t.precio_venta)*100:0).toFixed(1)+"%"}},{header:"Porciones",key:"porciones"},{header:"N¬∫ Ingredientes",value:t=>(t.ingredientes||[]).length}];window.exportarAExcel(window.recetas,"Recetas_LaCaleta",n)}async function ce(n){n.preventDefault();const t=document.querySelectorAll("#lista-ingredientes-receta .ingrediente-item"),o=[];if(t.forEach(i=>{const r=i.querySelector("select"),a=i.querySelector("input");r.value&&a.value&&o.push({ingredienteId:parseInt(r.value),cantidad:parseFloat(a.value)})}),o.length===0){window.showToast("A√±ade ingredientes a la receta","warning");return}const e={nombre:document.getElementById("rec-nombre").value,codigo:document.getElementById("rec-codigo").value,categoria:document.getElementById("rec-categoria").value,precio_venta:parseFloat(document.getElementById("rec-precio_venta").value)||0,porciones:parseInt(document.getElementById("rec-porciones").value)||1,ingredientes:o};window.showLoading();try{window.editandoRecetaId!==null?await window.api.updateReceta(window.editandoRecetaId,e):await window.api.createReceta(e),await window.cargarDatos(),window.renderizarRecetas(),window.hideLoading(),window.showToast(window.editandoRecetaId?"Receta actualizada":"Receta creada","success"),window.cerrarFormularioReceta()}catch(i){window.hideLoading(),console.error("Error:",i),window.showToast("Error guardando receta: "+i.message,"error")}}function se(n){const t=window.recetas.find(o=>o.id===n);t&&(document.getElementById("rec-nombre").value=t.nombre,document.getElementById("rec-codigo").value=t.codigo||"",document.getElementById("rec-categoria").value=t.categoria,document.getElementById("rec-precio_venta").value=t.precio_venta,document.getElementById("rec-porciones").value=t.porciones,document.getElementById("lista-ingredientes-receta").innerHTML="",t.ingredientes.forEach(o=>{window.agregarIngredienteReceta();const e=document.querySelector("#lista-ingredientes-receta .ingrediente-item:last-child");e.querySelector("select").value=o.ingredienteId,e.querySelector("input").value=o.cantidad}),window.calcularCosteReceta(),window.editandoRecetaId=n,document.getElementById("form-title-receta").textContent="Editar",document.getElementById("btn-text-receta").textContent="Guardar",window.mostrarFormularioReceta())}async function le(n){const t=window.recetas.find(o=>o.id===n);if(t&&confirm(`¬øEliminar la receta "${t.nombre}"?`)){window.showLoading();try{await window.api.deleteReceta(n),await window.cargarDatos(),window.renderizarRecetas(),window.hideLoading(),window.showToast("Receta eliminada","success")}catch(o){window.hideLoading(),console.error("Error:",o),window.showToast("Error eliminando receta: "+o.message,"error")}}}function ue(n){return!n||!n.ingredientes?0:n.ingredientes.reduce((t,o)=>{const e=window.ingredientes.find(r=>r.id===o.ingredienteId),i=e?parseFloat(e.precio):0;return t+i*o.cantidad},0)}function we(n){window.recetaProduciendo=n;const t=window.recetas.find(o=>o.id===n);document.getElementById("modal-plato-nombre").textContent=t.nombre,document.getElementById("modal-cantidad").value=1,window.actualizarDetalleDescuento(),document.getElementById("modal-producir").classList.add("active")}function B(){document.getElementById("modal-producir").classList.remove("active"),window.recetaProduciendo=null}function ge(){if(window.recetaProduciendo===null)return;const n=parseInt(document.getElementById("modal-cantidad").value)||1,t=window.recetas.find(e=>e.id===window.recetaProduciendo);let o='<ul style="margin:0;padding-left:20px;">';t.ingredientes.forEach(e=>{const i=window.ingredientes.find(r=>r.id===e.ingredienteId);i&&(o+=`<li>${i.nombre}: -${e.cantidad*n} ${i.unidad}</li>`)}),o+="</ul>",document.getElementById("modal-descuento-detalle").innerHTML=o}async function me(){if(window.recetaProduciendo===null)return;const n=parseInt(document.getElementById("modal-cantidad").value)||1,t=window.recetas.find(i=>i.id===window.recetaProduciendo);let o=!1,e=`Stock insuficiente:
`;if(t.ingredientes.forEach(i=>{const r=window.ingredientes.find(a=>a.id===i.ingredienteId);if(r){const a=i.cantidad*n;r.stockActual<a&&(o=!0,e+=`- ${r.nombre}: necesitas ${a}, tienes ${r.stockActual}
`)}}),o){alert(e);return}window.showLoading();try{for(const i of t.ingredientes){const r=window.ingredientes.find(a=>a.id===i.ingredienteId);if(r){const a=Math.max(0,r.stockActual-i.cantidad*n);await window.api.updateIngrediente(r.id,{...r,stockActual:a})}}await window.cargarDatos(),window.renderizarIngredientes(),window.hideLoading(),B(),window.showToast(`Producidas ${n} unidades de ${t.nombre}`,"success")}catch(i){window.hideLoading(),console.error("Error:",i),window.showToast("Error actualizando stock: "+i.message,"error")}}function pe(){document.getElementById("formulario-proveedor").style.display="block",D(),document.getElementById("prov-nombre").focus()}function fe(){document.getElementById("formulario-proveedor").style.display="none",document.querySelector("#formulario-proveedor form").reset(),window.editandoProveedorId=null,document.getElementById("form-title-proveedor").textContent="Nuevo Proveedor",document.getElementById("btn-text-proveedor").textContent="A√±adir"}function D(n=[]){const t=document.getElementById("lista-ingredientes-proveedor");if(window.ingredientes.length===0){t.innerHTML='<p style="color:#999;text-align:center;padding:20px;">Primero a√±ade ingredientes</p>';return}let o='<div class="search-box-small"><input type="text" id="buscar-ing-prov" placeholder="Buscar ingrediente..." oninput="window.filtrarIngredientesProveedor()"></div>';o+='<div id="lista-ing-checks">',window.ingredientes.forEach(e=>{const i=n.includes(e.id)?"checked":"";o+=`
      <div class="ing-check-item">
        <input type="checkbox" id="prov-ing-${e.id}" value="${e.id}" ${i}>
        <label for="prov-ing-${e.id}">${e.nombre}</label>
      </div>
    `}),o+="</div>",t.innerHTML=o}function he(){var o;const n=((o=document.getElementById("buscar-ing-prov"))==null?void 0:o.value.toLowerCase())||"";document.querySelectorAll(".ing-check-item").forEach(e=>{const i=e.querySelector("label").textContent.toLowerCase();e.style.display=i.includes(n)?"flex":"none"})}function ve(){var i;const n=((i=document.getElementById("busqueda-proveedores"))==null?void 0:i.value.toLowerCase())||"",t=window.proveedores.filter(r=>r.nombre.toLowerCase().includes(n)||r.telefono&&r.telefono.includes(n)||r.email&&r.email.toLowerCase().includes(n)),o=document.getElementById("tabla-proveedores");if(t.length===0){o.innerHTML=`
      <div class="empty-state">
        <div class="icon">üöö</div>
        <h3>${n?"No encontrados":"A√∫n no hay proveedores"}</h3>
      </div>
    `;return}let e="<table><thead><tr>";e+="<th>Nombre</th><th>Contacto</th><th>Ingredientes</th><th>Acciones</th>",e+="</tr></thead><tbody>",t.forEach(r=>{var d;const a=((d=r.ingredientes)==null?void 0:d.length)||0;e+="<tr>",e+=`<td><strong>${r.nombre}</strong></td>`,e+="<td>",r.telefono&&(e+=`üìû ${r.telefono}<br>`),r.email&&(e+=`‚úâÔ∏è ${r.email}`),e+="</td>",e+=`<td>${a} items</td>`,e+='<td><div class="actions">',e+=`<button class="icon-btn view" onclick="window.verProveedorDetalles(${r.id})">üëÅÔ∏è</button>`,e+=`<button class="icon-btn edit" onclick="window.editarProveedor(${r.id})">‚úèÔ∏è</button>`,e+=`<button class="icon-btn delete" onclick="window.eliminarProveedor(${r.id})">üóëÔ∏è</button>`,e+="</div></td>",e+="</tr>"}),e+="</tbody></table>",o.innerHTML=e}function ye(n){const t=window.proveedores.find(i=>i.id===n);if(!t)return;document.getElementById("modal-prov-nombre").textContent=t.nombre;let o="";t.telefono&&(o+=`<p>üìû ${t.telefono}</p>`),t.email&&(o+=`<p>‚úâÔ∏è ${t.email}</p>`),t.direccion&&(o+=`<p>üìç ${t.direccion}</p>`),document.getElementById("modal-prov-info").innerHTML=o;let e="<ul>";t.ingredientes&&t.ingredientes.length>0?t.ingredientes.forEach(i=>{const r=window.ingredientes.find(a=>a.id===i);r&&(e+=`<li>${r.nombre}</li>`)}):e+='<li style="color:#999;">Sin ingredientes asignados</li>',e+="</ul>",document.getElementById("modal-prov-ingredientes").innerHTML=e,document.getElementById("modal-ver-proveedor").classList.add("active")}function be(){document.getElementById("modal-ver-proveedor").classList.remove("active")}async function Ie(n){n.preventDefault();const t=document.querySelectorAll('#lista-ingredientes-proveedor input[type="checkbox"]:checked'),o=Array.from(t).map(i=>parseInt(i.value)),e={nombre:document.getElementById("prov-nombre").value,telefono:document.getElementById("prov-telefono").value||"",email:document.getElementById("prov-email").value||"",direccion:document.getElementById("prov-direccion").value||"",ingredientes:o};window.showLoading();try{window.editandoProveedorId!==null?await window.api.updateProveedor(window.editandoProveedorId,e):await window.api.createProveedor(e),await window.cargarDatos(),window.renderizarProveedores(),window.hideLoading(),window.showToast(window.editandoProveedorId?"Proveedor actualizado":"Proveedor creado","success"),window.cerrarFormularioProveedor()}catch(i){window.hideLoading(),console.error("Error:",i),window.showToast("Error guardando proveedor: "+i.message,"error")}}function Ee(n){const t=window.proveedores.find(o=>o.id===n);t&&(document.getElementById("prov-nombre").value=t.nombre,document.getElementById("prov-telefono").value=t.telefono||"",document.getElementById("prov-email").value=t.email||"",document.getElementById("prov-direccion").value=t.direccion||"",window.cargarIngredientesProveedor(t.ingredientes||[]),window.editandoProveedorId=n,document.getElementById("form-title-proveedor").textContent="Editar Proveedor",document.getElementById("btn-text-proveedor").textContent="Guardar",window.mostrarFormularioProveedor())}async function xe(n){const t=window.proveedores.find(o=>o.id===n);if(t&&confirm(`¬øEliminar proveedor "${t.nombre}"?`)){window.showLoading();try{await window.api.deleteProveedor(n),await window.cargarDatos(),window.renderizarProveedores(),window.hideLoading(),window.showToast("Proveedor eliminado","success")}catch(o){window.hideLoading(),console.error("Error:",o),window.showToast("Error eliminando proveedor: "+o.message,"error")}}}function Pe(){if(window.proveedores.length===0){window.showToast("Primero a√±ade proveedores","warning"),window.cambiarTab("proveedores");return}document.getElementById("formulario-pedido").style.display="block",window.cargarIngredientesPedido(),document.getElementById("ped-proveedor").focus()}function Fe(){document.getElementById("formulario-pedido").style.display="none",document.querySelector("#formulario-pedido form").reset(),window.editandoPedidoId=null}function $e(){const n=document.getElementById("lista-ingredientes-pedido");if(window.ingredientes.length===0){n.innerHTML='<p style="color:#999;text-align:center;padding:20px;">Primero a√±ade ingredientes</p>';return}let t="";window.ingredientes.forEach(o=>{t+=`
      <div class="ingrediente-check">
        <input type="checkbox" id="ing-${o.id}" value="${o.id}" onchange="window.calcularTotalPedido()">
        <label for="ing-${o.id}">${o.nombre} (${o.precio}‚Ç¨/${o.unidad})</label>
        <input type="number" step="0.01" min="0" placeholder="Cantidad" disabled 
               data-ing-id="${o.id}" class="cantidad-pedido" onchange="window.calcularTotalPedido()">
      </div>
    `}),n.innerHTML=t,n.querySelectorAll('input[type="checkbox"]').forEach(o=>{o.addEventListener("change",e=>{const i=n.querySelector(`input.cantidad-pedido[data-ing-id="${e.target.value}"]`);i&&(i.disabled=!e.target.checked,e.target.checked||(i.value=""))})})}function Ce(){window.calcularTotalPedido()}function Se(){const n=document.querySelectorAll('#lista-ingredientes-pedido input[type="checkbox"]:checked');let t=0;n.forEach(e=>{const i=document.querySelector(`input.cantidad-pedido[data-ing-id="${e.value}"]`);if(i&&i.value){const r=window.ingredientes.find(a=>a.id===parseInt(e.value));r&&(t+=parseFloat(r.precio||0)*parseFloat(i.value||0))}});const o=document.getElementById("total-pedido");return o&&(o.textContent=t.toFixed(2)+"‚Ç¨"),t}function Le(){var i;const n=document.getElementById("tabla-pedidos"),t=((i=document.getElementById("filtro-estado-pedido"))==null?void 0:i.value)||"todos";let o=window.pedidos;if(t!=="todos"&&(o=window.pedidos.filter(r=>r.estado===t)),o.length===0){n.innerHTML=`
      <div class="empty-state">
        <div class="icon">üì¶</div>
        <h3>No hay pedidos</h3>
      </div>
    `;return}let e="<table><thead><tr>";e+="<th>ID</th><th>Fecha</th><th>Proveedor</th><th>Items</th><th>Total</th><th>Estado</th><th>Acciones</th>",e+="</tr></thead><tbody>",o.forEach(r=>{var s;const a=window.proveedores.find(u=>u.id===r.proveedorId),d=new Date(r.fecha).toLocaleDateString("es-ES");e+="<tr>",e+=`<td>#${r.id}</td>`,e+=`<td>${d}</td>`,e+=`<td>${a?a.nombre:"Sin proveedor"}</td>`,e+=`<td>${((s=r.ingredientes)==null?void 0:s.length)||0}</td>`,e+=`<td>${parseFloat(r.total||0).toFixed(2)}‚Ç¨</td>`;const c=r.estado==="recibido"?"badge-success":"badge-warning";e+=`<td><span class="badge ${c}">${r.estado}</span></td>`,e+='<td><div class="actions">',e+=`<button type="button" class="icon-btn view" onclick="window.verDetallesPedido(${r.id})" title="Ver detalles">üëÅÔ∏è</button>`,r.estado==="pendiente"&&(e+=`<button type="button" class="icon-btn success" onclick="window.marcarPedidoRecibido(${r.id})" title="Recibir">‚úÖ</button>`),e+=`<button type="button" class="icon-btn delete" onclick="window.eliminarPedido(${r.id})">üóëÔ∏è</button>`,e+="</div></td>",e+="</tr>"}),e+="</tbody></table>",n.innerHTML=e}function Te(){const n=[{header:"ID",key:"id"},{header:"Fecha Pedido",value:t=>new Date(t.fecha).toLocaleDateString("es-ES")},{header:"Proveedor",value:t=>{const o=window.proveedores.find(e=>e.id===t.proveedorId);return o?o.nombre:"Sin proveedor"}},{header:"Estado",key:"estado"},{header:"N¬∫ Ingredientes",value:t=>(t.ingredientes||[]).length},{header:"Total (‚Ç¨)",value:t=>parseFloat(t.total||0).toFixed(2)},{header:"Total Recibido (‚Ç¨)",value:t=>parseFloat(t.total_recibido||0).toFixed(2)},{header:"Fecha Recepci√≥n",value:t=>t.fecha_recepcion?new Date(t.fecha_recepcion).toLocaleDateString("es-ES"):"-"}];window.exportarAExcel(window.pedidos,"Pedidos_LaCaleta",n)}async function ke(n){n.preventDefault();const t=document.querySelectorAll('#lista-ingredientes-pedido input[type="checkbox"]:checked'),o=[];if(t.forEach(i=>{var a;const r=document.querySelector(`input.cantidad-pedido[data-ing-id="${i.value}"]`);r&&r.value&&o.push({ingredienteId:parseInt(i.value),cantidad:parseFloat(r.value),precio_unitario:((a=window.ingredientes.find(d=>d.id===parseInt(i.value)))==null?void 0:a.precio)||0})}),o.length===0){window.showToast("Selecciona al menos un ingrediente","warning");return}const e={proveedorId:parseInt(document.getElementById("ped-proveedor").value),fecha:new Date().toISOString(),estado:"pendiente",ingredientes:o,total:window.calcularTotalPedido()};window.showLoading();try{await window.api.createPedido(e),await window.cargarDatos(),window.renderizarPedidos(),window.hideLoading(),window.showToast("Pedido creado","success"),window.cerrarFormularioPedido()}catch(i){window.hideLoading(),console.error("Error:",i),window.showToast("Error guardando pedido: "+i.message,"error")}}async function Be(n){if(window.pedidos.find(o=>o.id===n)&&confirm(`¬øEliminar el pedido #${n}?`)){window.showLoading();try{await window.api.deletePedido(n),await window.cargarDatos(),window.renderizarPedidos(),window.hideLoading(),window.showToast("Pedido eliminado","success")}catch(o){window.hideLoading(),console.error("Error:",o),window.showToast("Error eliminando pedido: "+o.message,"error")}}}function De(n){window.pedidoRecibiendoId=n;const t=window.pedidos.find(i=>i.id===n);if(!t)return;const o=document.getElementById("modal-recibir-ingredientes");let e="";t.ingredientes.forEach(i=>{const r=window.ingredientes.find(a=>a.id===i.ingredienteId);r&&(e+=`
        <div style="display:flex;gap:10px;margin:10px 0;align-items:center;">
          <span style="flex:1;">${r.nombre}</span>
          <span style="width:80px;text-align:right;">Pedido: ${i.cantidad}</span>
          <input type="number" step="0.01" min="0" value="${i.cantidad}" 
                 data-ing-id="${r.id}" data-precio="${r.precio}"
                 class="cantidad-recibida" 
                 style="width:100px;padding:5px;">
          <span style="width:60px;text-align:right;">${r.unidad}</span>
        </div>
      `)}),o.innerHTML=e,document.getElementById("modal-recibir").classList.add("active")}function R(){document.getElementById("modal-recibir").classList.remove("active"),window.pedidoRecibiendoId=null}async function Re(){if(window.pedidoRecibiendoId===null)return;const n=document.querySelectorAll(".cantidad-recibida"),t=window.pedidos.find(o=>o.id===window.pedidoRecibiendoId);window.showLoading();try{let o=0;for(const e of n){const i=parseInt(e.dataset.ingId),r=parseFloat(e.value)||0,a=parseFloat(e.dataset.precio)||0;o+=r*a;const d=window.ingredientes.find(c=>c.id===i);if(d){const c=(d.stockActual||0)+r;await window.api.updateIngrediente(i,{...d,stockActual:c})}}await window.api.updatePedido(window.pedidoRecibiendoId,{...t,estado:"recibido",fecha_recepcion:new Date().toISOString(),total_recibido:o}),await window.cargarDatos(),window.renderizarPedidos(),window.renderizarIngredientes(),window.hideLoading(),R(),window.showToast("Pedido recibido, stock actualizado","success")}catch(o){window.hideLoading(),console.error("Error:",o),window.showToast("Error recibiendo pedido: "+o.message,"error")}}function Me(n){window.pedidoViendoId=n;const t=window.pedidos.find(i=>i.id===n);if(!t)return;const o=window.proveedores.find(i=>i.id===t.proveedorId);document.getElementById("modal-pedido-id").textContent=`#${t.id}`,document.getElementById("modal-pedido-proveedor").textContent=o?o.nombre:"Sin proveedor",document.getElementById("modal-pedido-fecha").textContent=new Date(t.fecha).toLocaleString("es-ES"),document.getElementById("modal-pedido-estado").textContent=t.estado,document.getElementById("modal-pedido-estado").className=`badge ${t.estado==="recibido"?"badge-success":"badge-warning"}`;let e="<table><thead><tr><th>Ingrediente</th><th>Cantidad</th><th>Precio Unit.</th><th>Subtotal</th></tr></thead><tbody>";t.ingredientes.forEach(i=>{const r=window.ingredientes.find(a=>a.id===i.ingredienteId);if(r){const a=i.cantidad*i.precio_unitario;e+="<tr>",e+=`<td>${r.nombre}</td>`,e+=`<td>${i.cantidad} ${r.unidad}</td>`,e+=`<td>${parseFloat(i.precio_unitario||0).toFixed(2)}‚Ç¨</td>`,e+=`<td>${a.toFixed(2)}‚Ç¨</td>`,e+="</tr>"}}),e+="</tbody></table>",document.getElementById("modal-pedido-ingredientes").innerHTML=e,document.getElementById("modal-pedido-total").textContent=parseFloat(t.total||0).toFixed(2)+"‚Ç¨",t.fecha_recepcion?(document.getElementById("modal-pedido-recepcion").textContent=new Date(t.fecha_recepcion).toLocaleString("es-ES"),document.getElementById("modal-pedido-total-recibido").textContent=parseFloat(t.total_recibido||0).toFixed(2)+"‚Ç¨"):(document.getElementById("modal-pedido-recepcion").textContent="Pendiente",document.getElementById("modal-pedido-total-recibido").textContent="-"),document.getElementById("modal-ver-pedido").classList.add("active")}function _e(){document.getElementById("modal-ver-pedido").classList.remove("active"),window.pedidoViendoId=null}function Ae(){if(window.pedidoViendoId===null)return;const n=JSON.parse(localStorage.getItem("user")||"{}"),t=window.pedidos.find(r=>r.id===window.pedidoViendoId),o=window.proveedores.find(r=>r.id===t.proveedorId);let e=`
    <html>
    <head>
      <title>Pedido #${t.id}</title>
      <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        h1 { color: #7c3aed; }
        table { width: 100%; border-collapse: collapse; margin: 20px 0; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background: #7c3aed; color: white; }
        .total { font-size: 18px; font-weight: bold; text-align: right; margin-top: 20px; }
      </style>
    </head>
    <body>
      <h1>Pedido #${t.id}</h1>
      <p><strong>Restaurante:</strong> ${n.nombre||"La Caleta"}</p>
      <p><strong>Proveedor:</strong> ${o?o.nombre:"Sin proveedor"}</p>
      <p><strong>Fecha:</strong> ${new Date(t.fecha).toLocaleString("es-ES")}</p>
      <p><strong>Estado:</strong> ${t.estado}</p>
      <table>
        <thead>
          <tr><th>Ingrediente</th><th>Cantidad</th><th>Precio Unit.</th><th>Subtotal</th></tr>
        </thead>
        <tbody>
  `;t.ingredientes.forEach(r=>{const a=window.ingredientes.find(d=>d.id===r.ingredienteId);if(a){const d=r.cantidad*r.precio_unitario;e+=`
        <tr>
          <td>${a.nombre}</td>
          <td>${r.cantidad} ${a.unidad}</td>
          <td>${parseFloat(r.precio_unitario||0).toFixed(2)}‚Ç¨</td>
          <td>${d.toFixed(2)}‚Ç¨</td>
        </tr>
      `}}),e+=`
        </tbody>
      </table>
      <div class="total">Total: ${parseFloat(t.total||0).toFixed(2)}‚Ç¨</div>
    </body>
    </html>
  `;const i=window.open("","","width=800,height=600");i.document.write(e),i.document.close(),i.print()}async function ze(){try{const n=await window.api.getSales(),t=document.getElementById("tabla-ventas");if(n.length===0){t.innerHTML=`
        <div class="empty-state">
          <div class="icon">üí∞</div>
          <h3>No hay ventas registradas</h3>
        </div>
      `;return}const o={};n.forEach(i=>{const r=new Date(i.fecha).toLocaleDateString("es-ES");o[r]||(o[r]=[]),o[r].push(i)});let e='<table style="width:100%;border-collapse:collapse;"><tbody>';Object.keys(o).sort((i,r)=>new Date(r)-new Date(i)).forEach(i=>{const r=o[i],a=r.reduce((d,c)=>d+parseFloat(c.total||0),0);e+=`<tr style="background:#F8FAFC;"><td colspan="6" style="padding:12px 16px;font-weight:600;color:#1E293B;border-bottom:1px solid #E2E8F0;">${i} - Total: ${a.toFixed(2)}‚Ç¨</td></tr>`,r.forEach(d=>{const c=new Date(d.fecha).toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit"});e+=`<tr><td style="padding:8px 16px 8px 32px;color:#64748B;">${i}</td><td style="padding:8px 16px;color:#64748B;">${c}</td><td style="padding:8px 16px;color:#1E293B;">${d.receta_nombre}</td><td style="padding:8px 16px;text-align:center;color:#64748B;">${d.cantidad}</td><td style="padding:8px 16px;text-align:right;"><strong style="color:#1E293B;">${parseFloat(d.total).toFixed(2)}‚Ç¨</strong></td><td style="padding:8px 16px;text-align:center;"><button class="icon-btn delete" onclick="window.eliminarVenta(${d.id})" title="Eliminar">üóëÔ∏è</button></td></tr>`})}),e+="</tbody></table>",t.innerHTML=e}catch(n){console.error("Error renderizando ventas:",n),window.showToast("Error cargando ventas","error")}}function qe(){window.api.getSales().then(n=>{const t=[{header:"ID",key:"id"},{header:"Fecha",value:o=>new Date(o.fecha).toLocaleDateString("es-ES")},{header:"Hora",value:o=>new Date(o.fecha).toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit"})},{header:"C√≥digo Receta",value:o=>{const e=window.recetas.find(i=>i.id===o.receta_id);return(e==null?void 0:e.codigo)||`REC-${String(o.receta_id).padStart(4,"0")}`}},{header:"Descripci√≥n",value:o=>{var e;return o.receta_nombre||((e=window.recetas.find(i=>i.id===o.receta_id))==null?void 0:e.nombre)||"Desconocida"}},{header:"Cantidad",key:"cantidad"},{header:"Precio Unitario (‚Ç¨)",value:o=>parseFloat(o.precio_unitario||0).toFixed(2)},{header:"Total (‚Ç¨)",value:o=>parseFloat(o.total||0).toFixed(2)}];window.exportarAExcel(n,"Ventas_LaCaleta",t)})}async function Ne(n){if(confirm("¬øEliminar esta venta?")){window.showLoading();try{await window.api.deleteSale(n),await window.renderizarVentas(),window.hideLoading(),window.showToast("Venta eliminada","success")}catch(t){window.hideLoading(),console.error("Error:",t),window.showToast("Error eliminando venta: "+t.message,"error")}}}async function Oe(){try{const t=(await window.api.getSales()).reduce((c,s)=>c+parseFloat(s.total),0),o=document.getElementById("kpi-ingresos");o&&(o.textContent=t.toFixed(0)+"‚Ç¨");const e=window.pedidos.filter(c=>c.estado==="pendiente").length,i=document.getElementById("kpi-pedidos");i&&(i.textContent=e);const r=window.ingredientes.filter(c=>{const s=parseFloat(c.stockActual||0),u=parseFloat(c.stockMinimo||0);return s<u}).length,a=document.getElementById("kpi-stock");a&&(a.textContent=r);const d=window.recetas.filter(c=>c.precio_venta>0);if(d.length>0){const s=d.reduce((w,g)=>{const y=window.calcularCosteRecetaCompleto?window.calcularCosteRecetaCompleto(g):0,b=g.precio_venta>0?(g.precio_venta-y)/g.precio_venta*100:0;return w+b},0)/d.length,u=document.getElementById("kpi-margen");u&&(u.textContent=Math.round(s)+"%")}}catch(n){console.error("Error actualizando KPIs:",n)}}function M(n,t){var E;if(!window.jspdf)return console.error("jsPDF no est√° cargado. Aseg√∫rate de que los scripts CDN est√°n cargados."),(E=window.showToast)==null||E.call(window,"Error: Librer√≠a PDF no cargada","error"),null;const{jsPDF:o}=window.jspdf,e=new o,i=[255,107,53],r=[30,41,59],a=[100,116,139];e.setFillColor(...i),e.rect(0,0,210,40,"F"),e.setTextColor(255,255,255),e.setFontSize(24),e.setFont("helvetica","bold"),e.text("MindLoop CostOS",105,18,{align:"center"}),e.setFontSize(12),e.setFont("helvetica","normal"),e.text("Restaurant Intelligence Platform",105,28,{align:"center"});let d=55;e.setTextColor(...r),e.setFontSize(18),e.setFont("helvetica","bold"),e.text(`RECETA: ${n.nombre.toUpperCase()}`,20,d),d+=10,e.setFontSize(10),e.setFont("helvetica","normal"),e.setTextColor(...a),e.text(`C√≥digo: ${n.codigo||"N/A"}`,20,d),e.text(`Categor√≠a: ${n.categoria||"N/A"}`,80,d),e.text(`Porciones: ${n.porciones||1}`,140,d),d+=8,e.setDrawColor(...i),e.setLineWidth(.5),e.line(20,d,190,d),d+=10,e.setTextColor(...r),e.setFontSize(14),e.setFont("helvetica","bold"),e.text("INGREDIENTES:",20,d),d+=8;let c=0;const s=[];n.ingredientes&&Array.isArray(n.ingredientes)&&n.ingredientes.forEach(I=>{const v=t.find(f=>f.id===I.ingredienteId||f.id===I.ingrediente_id);if(v){const f=I.cantidad||0,x=v.precio||0,P=f*x;c+=P,s.push([v.nombre,`${f} ${v.unidad||"kg"}`,`${x.toFixed(2)}‚Ç¨`,`${P.toFixed(2)}‚Ç¨`])}}),e.autoTable({startY:d,head:[["Ingrediente","Cantidad","Precio/Unidad","Subtotal"]],body:s,theme:"striped",headStyles:{fillColor:i,textColor:[255,255,255],fontSize:10,fontStyle:"bold",halign:"left"},bodyStyles:{fontSize:9,textColor:r},alternateRowStyles:{fillColor:[248,250,252]},columnStyles:{0:{cellWidth:70},1:{cellWidth:40,halign:"center"},2:{cellWidth:35,halign:"right"},3:{cellWidth:35,halign:"right"}},margin:{left:20,right:20}}),d=e.lastAutoTable.finalY+15,e.setDrawColor(...i),e.setLineWidth(.5),e.line(20,d,190,d),d+=12;const u=n.precio_venta||0,w=u>0?(u-c)/u*100:0;e.setFontSize(12),e.setFont("helvetica","bold"),e.setTextColor(...r),e.text("COSTE TOTAL:",20,d),e.text(`${c.toFixed(2)}‚Ç¨`,100,d,{align:"right"}),d+=8,e.text("PRECIO VENTA:",20,d),e.setTextColor(16,185,129),e.text(`${u.toFixed(2)}‚Ç¨`,100,d,{align:"right"}),d+=8,e.setTextColor(...r),e.text("BENEFICIO:",20,d);const g=u-c;e.setTextColor(g>=0?[16,185,129]:[239,68,68]),e.text(`${g.toFixed(2)}‚Ç¨`,100,d,{align:"right"}),d+=8,e.setTextColor(...r),e.text("MARGEN:",20,d),e.setTextColor(w>=25?[16,185,129]:w>=15?[245,158,11]:[239,68,68]),e.text(`${w.toFixed(1)}%`,100,d,{align:"right"});const y=new Date().toLocaleDateString("es-ES");e.setFontSize(8),e.setTextColor(...a),e.setFont("helvetica","normal"),e.text(`Generado el ${y} por MindLoop CostOS`,105,280,{align:"center"});const b=`Receta_${n.nombre.replace(/\s+/g,"_")}_${Date.now()}.pdf`;return e.save(b),e}function _(n){const{jsPDF:t}=window.jspdf,o=new t,e=[255,107,53],i=[30,41,59],r=[100,116,139];o.setFillColor(...e),o.rect(0,0,210,35,"F"),o.setTextColor(255,255,255),o.setFontSize(20),o.setFont("helvetica","bold"),o.text("LISTA DE INGREDIENTES",105,22,{align:"center"});const a=n.map(c=>{var s;return[c.nombre,c.unidad||"kg",`${(c.precio||0).toFixed(2)}‚Ç¨`,`${(c.stock_actual||0).toFixed(2)}`,((s=c.proveedor)==null?void 0:s.nombre)||"N/A"]});o.autoTable({startY:45,head:[["Ingrediente","Unidad","Precio","Stock","Proveedor"]],body:a,theme:"striped",headStyles:{fillColor:e,textColor:[255,255,255],fontSize:10,fontStyle:"bold"},bodyStyles:{fontSize:9,textColor:i},alternateRowStyles:{fillColor:[248,250,252]},columnStyles:{2:{halign:"right"},3:{halign:"right"}}});const d=new Date().toLocaleDateString("es-ES");return o.setFontSize(8),o.setTextColor(...r),o.text(`Generado el ${d}`,105,280,{align:"center"}),o.save(`Ingredientes_${Date.now()}.pdf`),o}typeof window<"u"&&(window.generarPDFReceta=M,window.generarPDFIngredientes=_);function A(n){const t=window.recetas.find(o=>o.id===n);if(!t){window.showToast("Receta no encontrada","error");return}typeof window.generarPDFReceta=="function"?(window.generarPDFReceta(t,window.ingredientes),window.showToast("PDF generado correctamente","success")):(console.error("generarPDFReceta no est√° disponible"),window.showToast("Error: M√≥dulo PDF no cargado","error"))}window.descargarPDFReceta=A;window.showToast=m;window.DOM=$;Object.assign(window,$);window.showLoading=C;window.hideLoading=S;window.exportarAExcel=L;window.formatCurrency=T;window.formatDate=k;window.renderizarIngredientes=K;window.mostrarFormularioIngrediente=Y;window.cerrarFormularioIngrediente=W;window.exportarIngredientes=Q;window.guardarIngrediente=Z;window.editarIngrediente=ee;window.eliminarIngrediente=te;window.renderizarRecetas=de;window.mostrarFormularioReceta=oe;window.cerrarFormularioReceta=ne;window.agregarIngredienteReceta=ie;window.calcularCosteReceta=re;window.exportarRecetas=ae;window.guardarReceta=ce;window.editarReceta=se;window.eliminarReceta=le;window.calcularCosteRecetaCompleto=ue;window.abrirModalProducir=we;window.cerrarModalProducir=B;window.actualizarDetalleDescuento=ge;window.confirmarProduccion=me;window.renderizarProveedores=ve;window.mostrarFormularioProveedor=pe;window.cerrarFormularioProveedor=fe;window.cargarIngredientesProveedor=D;window.filtrarIngredientesProveedor=he;window.verProveedorDetalles=ye;window.cerrarModalVerProveedor=be;window.guardarProveedor=Ie;window.editarProveedor=Ee;window.eliminarProveedor=xe;window.renderizarPedidos=Le;window.mostrarFormularioPedido=Pe;window.cerrarFormularioPedido=Fe;window.cargarIngredientesPedido=$e;window.agregarIngredientePedido=Ce;window.calcularTotalPedido=Se;window.exportarPedidos=Te;window.guardarPedido=ke;window.eliminarPedido=Be;window.marcarPedidoRecibido=De;window.cerrarModalRecibirPedido=R;window.confirmarRecepcionPedido=Re;window.verDetallesPedido=Me;window.cerrarModalVerPedido=_e;window.descargarPedidoPDF=Ae;window.renderizarVentas=ze;window.exportarVentas=qe;window.eliminarVenta=Ne;window.actualizarKPIs=Oe;window.generarPDFReceta=M;window.generarPDFIngredientes=_;window.descargarPDFReceta=A;window.editandoIngredienteId=null;window.editandoRecetaId=null;window.editandoPedidoId=null;window.editandoProveedorId=null;console.log("");console.log("üçΩÔ∏è LaCaletaCost v2.0.0");console.log("‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ");console.log("‚úÖ M√≥dulo Ingredientes - ACTIVO");console.log("‚úÖ M√≥dulo Recetas - ACTIVO");console.log("‚úÖ M√≥dulo Proveedores - ACTIVO");console.log("‚úÖ M√≥dulo Pedidos - ACTIVO");console.log("‚úÖ M√≥dulo Ventas - ACTIVO");console.log("‚úÖ M√≥dulo Dashboard - ACTIVO");console.log("‚úÖ M√≥dulo Export PDF - ACTIVO");console.log("‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ");console.log("üöÄ Todos los m√≥dulos cargados");console.log("");
//# sourceMappingURL=main-BP6WGAQv.js.map
